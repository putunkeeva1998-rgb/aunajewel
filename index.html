<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUNA jewel | Premium Shop</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #000000;
            --bg: #ffffff;
            --card-bg: #fdfdfd;
            --text-main: #1a1a1a;
            --text-muted: #8e8e93;
            --error: #ff3b30;
            --border: #f0f0f0;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            overflow-x: hidden;
            padding-bottom: 120px;
        }

        [v-cloak] { display: none; }

        /* HEADER */
        header {
            position: sticky; top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            z-index: 1000;
            padding: 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .logo { font-weight: 900; font-size: 18px; letter-spacing: 6px; text-transform: uppercase; margin: 0; }

        /* BURGER MENU */
        .burger-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 2000; padding: 60px 30px;
            transform: translateX(-100%); transition: 0.5s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .burger-menu.active { transform: translateX(0); }
        .burger-close { font-size: 35px; margin-bottom: 40px; cursor: pointer; }
        .burger-item { font-size: 26px; font-weight: 800; margin-bottom: 30px; text-transform: uppercase; cursor: pointer; }

        /* INFO PAGES */
        .info-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 4000; padding: 40px 25px; overflow-y: auto;
        }

        /* CATALOG */
        .categories { display: flex; gap: 12px; padding: 20px; overflow-x: auto; scrollbar-width: none; }
        .category-tab {
            padding: 10px 22px; border-radius: 30px; background: #f5f5f7;
            font-size: 13px; font-weight: 600; white-space: nowrap; transition: 0.4s;
        }
        .category-tab.active { background: var(--accent); color: white; }

        .catalog { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; }
        .product-card { background: var(--card-bg); border-radius: 20px; overflow: hidden; position: relative; box-shadow: var(--shadow); }
        
        .product-image-container { 
            width: 100%; aspect-ratio: 1/1.2; background: #eee; position: relative; overflow: hidden;
        }
        .product-image-container img { 
            width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.3s ease;
        }
        .product-image-container img.loaded { opacity: 1; }

        /* MAP */
        #map-container {
            position: relative; width: 100%; height: 320px; margin: 15px 0;
            border-radius: 20px; overflow: hidden; border: 1px solid var(--border); z-index: 5;
        }
        #map { width: 100%; height: 100%; }
        .address-box {
            padding: 15px; background: #f9f9f9; border-radius: 15px;
            font-size: 13px; margin-bottom: 25px; border-left: 4px solid #000;
        }

        /* CART */
        .cart-item { display: flex; gap: 15px; padding: 15px; background: #fff; border-radius: 20px; margin-bottom: 12px; box-shadow: var(--shadow); align-items: center; }
        .cart-item img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; }

        /* SIZES */
        .size-selector { display: flex; gap: 8px; margin: 15px 0; overflow-x: auto; padding-bottom: 5px; }
        .size-badge { padding: 8px 15px; border: 1px solid #eee; border-radius: 10px; font-size: 12px; font-weight: 700; }
        .size-badge.active { background: #000; color: #fff; border-color: #000; }

        /* MODAL */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 3000; overflow-y: auto; }
        .close-modal { position: absolute; top: 20px; right: 20px; z-index: 100; width: 40px; height: 40px; background: rgba(0,0,0,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* BUTTONS */
        .btn-main { width: 100%; padding: 18px; background: black; color: white; border-radius: 15px; border: none; font-weight: 800; font-size: 15px; }
        .btn-main:disabled { background: #ccc; }

        /* NAV BAR */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px); display: flex; justify-content: space-around; 
            padding: 15px 10px 35px; border-top: 1px solid var(--border); z-index: 1500;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 5px; color: var(--text-muted); font-size: 10px; font-weight: 700; }
        .nav-item.active { color: var(--accent); }
        .badge { position: absolute; top: -5px; right: -10px; background: var(--error); color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; }

        /* ADMIN */
        .admin-panel { background: #fff; border: 2px solid #000; border-radius: 20px; padding: 20px; margin-top: 30px; }
        .admin-input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #eee; font-family: inherit; }

    </style>
</head>
<body>

<div id="app" v-cloak>
    
    <header>
        <div @click="burgerOpen = true; vibrate()">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </div>
        <h1 class="logo">AUNA jewel</h1>
        <div style="width:26px"></div>
    </header>

    <div class="burger-menu" :class="{active: burgerOpen}">
        <div class="burger-close" @click="burgerOpen = false">‚úï</div>
        <div class="burger-item" @click="openInfo('about')">–û –±—Ä–µ–Ω–¥–µ</div>
        <div class="burger-item" @click="openInfo('delivery')">–î–æ—Å—Ç–∞–≤–∫–∞</div>
        <div class="burger-item" @click="openInfo('return')">–í–æ–∑–≤—Ä–∞—Ç</div>
        <div class="burger-item" @click="contactSupport">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
    </div>

    <div class="info-page" v-if="currentInfo">
        <div @click="currentInfo = null" style="font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg> –ù–ê–ó–ê–î
        </div>
        <h1 style="font-weight: 900; text-transform: uppercase;">{{ infoData[currentInfo].title }}</h1>
        <p style="line-height: 1.8; white-space: pre-line; color: #444;">{{ infoData[currentInfo].text }}</p>
    </div>

    <main>
        <div v-if="activeTab === 'catalog'">
            <div class="categories">
                <div v-for="cat in ['–í—Å–µ', '–°–µ—Ä—å–≥–∏', '–¶–µ–ø–æ—á–∫–∏', '–ö–æ–ª—å—Ü–∞', '–ë—Ä–∞—Å–ª–µ—Ç—ã']" 
                     @click="currentCategory = cat" 
                     :class="['category-tab', currentCategory === cat ? 'active' : '']">{{cat}}</div>
            </div>
            <div class="catalog">
                <div v-for="p in filteredProducts" :key="p.id" class="product-card" @click="selP = p; activeSize = (p.sizes && p.sizes[0]) || 'Uni'">
                    <div class="product-image-container">
                        <img :src="p.displayImage" @load="e => e.target.classList.add('loaded')">
                    </div>
                    <div style="padding: 12px;">
                        <div style="font-size: 13px; font-weight: 700; height: 32px; overflow: hidden;">{{p.name}}</div>
                        <div style="font-weight: 900; font-size: 15px; margin-top: 5px;">{{p.price}} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-show="activeTab === 'cart'" style="padding: 20px">
            <h1 style="font-weight: 900;">–í–∞—à –∑–∞–∫–∞–∑</h1>
            <div v-if="cart.length === 0" style="text-align:center; padding: 60px 0; color: #888;">–í –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç</div>
            <div v-else>
                <div v-for="(item, index) in cart" :key="index" class="cart-item">
                    <img :src="item.displayImage">
                    <div style="flex:1">
                        <div style="font-weight: 800; font-size: 13px;">{{item.name}}</div>
                        <div style="font-size: 11px; color: #888;">–†–∞–∑–º–µ—Ä: {{item.selectedSize}}</div>
                        <div style="font-weight: 900; margin-top: 4px;">{{item.price}} ‚ÇΩ</div>
                    </div>
                    <div @click="removeFromCart(index)" style="color:red; padding:10px;">‚úï</div>
                </div>

                <div style="margin-top: 30px;">
                    <label style="font-size: 10px; font-weight: 800; color: #888;">–í–ê–®–ò –î–ê–ù–ù–´–ï</label>
                    <input class="admin-input" v-model="form.name" placeholder="–ò–º—è">
                    <input class="admin-input" v-model="form.phone" type="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                    
                    <label style="font-size: 10px; font-weight: 800; color: #888; margin-top: 15px; display: block;">–í–´–ë–ï–†–ò–¢–ï –ü–£–ù–ö–¢ –í–´–î–ê–ß–ò:</label>
                    <div id="map-container"><div id="map"></div></div>
                    <div class="address-box">
                        <strong>–ê–¥—Ä–µ—Å:</strong> {{ form.address || '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É...' }}
                    </div>

                    <button class="btn-main" @click="sendOrder" :disabled="!form.address">–û–§–û–†–ú–ò–¢–¨ ‚Äî {{cartTotal} ‚ÇΩ</button>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'profile'" style="padding: 25px">
            <div style="text-align:center; margin-bottom: 30px;">
                <img :src="user.photo || 'https://via.placeholder.com/100'" style="width:90px; border-radius:50%; border: 3px solid #eee;">
                <h2 style="font-weight: 900; margin-top: 10px;">{{user.first_name}}</h2>
            </div>

            <div v-if="isAdmin" class="admin-panel">
                <h3 style="font-weight: 900; text-align: center; margin-bottom: 20px;">–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h3>
                <input class="admin-input" v-model="newP.name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <input class="admin-input" v-model="newP.price" type="number" placeholder="–¶–µ–Ω–∞">
                <textarea class="admin-input" v-model="newP.desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="3"></textarea>
                <select class="admin-input" v-model="newP.cat">
                    <option>–°–µ—Ä—å–≥–∏</option><option>–¶–µ–ø–æ—á–∫–∏</option><option>–ö–æ–ª—å—Ü–∞</option><option>–ë—Ä–∞—Å–ª–µ—Ç—ã</option>
                </select>
                <div style="margin-bottom: 15px;">
                    <label style="font-size: 10px; font-weight: 800;">–§–û–¢–û (IMGBB):</label>
                    <input type="file" @change="uploadToImgBB" multiple style="font-size: 11px; margin-top: 5px;">
                </div>
                <button class="btn-main" @click="saveProduct" :disabled="loading">
                    {{ loading ? '–ó–ê–ì–†–£–ó–ö–ê...' : '–î–û–ë–ê–í–ò–¢–¨ –í –ö–ê–¢–ê–õ–û–ì' }}
                </button>

                <div style="margin-top: 25px;">
                    <div v-for="p in products" :key="p.id" style="display:flex; justify-content:space-between; padding:10px; background:#f9f9f9; border-radius:10px; margin-bottom:8px; align-items:center;">
                        <span style="font-size:11px; font-weight:700;">{{p.name}}</span>
                        <button @click="toggleHide(p)" :style="{background: p.hidden ? 'red':'#34c759', color:'white', border:'none', padding:'5px 10px', borderRadius:'5px', fontSize:'9px'}">
                            {{p.hidden ? '–°–ö–†–´–¢':'–í–ò–î–ï–ù'}}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="modal" v-if="selP">
        <div class="close-modal" @click="selP = null">‚úï</div>
        <img :src="selP.displayImage" style="width:100%; height:55vh; object-fit:cover;">
        <div style="padding: 25px;">
            <h1 style="font-weight: 900; margin: 0;">{{selP.name}}</h1>
            <div style="font-size: 22px; font-weight: 900; margin: 10px 0;">{{selP.price}} ‚ÇΩ</div>
            <p style="color:#666; font-size:14px; line-height:1.6;">{{selP.description || selP.desc}}</p>
            
            <div v-if="selP.sizes && selP.sizes.length">
                <label style="font-size:10px; font-weight:800; color:#888;">–í–´–ë–ï–†–ò–¢–ï –†–ê–ó–ú–ï–†:</label>
                <div class="size-selector">
                    <div v-for="s in selP.sizes" @click="activeSize = s" :class="['size-badge', activeSize === s ? 'active' : '']">{{s}}</div>
                </div>
            </div>

            <button class="btn-main" @click="addToCart(selP)">–î–û–ë–ê–í–ò–¢–¨ –í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item" :class="{active: activeTab === 'catalog'}" @click="activeTab = 'catalog'">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            –ö–ê–¢–ê–õ–û–ì
        </div>
        <div class="nav-item" :class="{active: activeTab === 'cart'}" @click="activeTab = 'cart'">
            <div style="position:relative;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path></svg>
                <span v-if="cart.length" class="badge">{{cart.length}}</span>
            </div>
            –ö–û–†–ó–ò–ù–ê
        </div>
        <div class="nav-item" :class="{active: activeTab === 'profile'}" @click="activeTab = 'profile'">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="7" r="4"></circle><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path></svg>
            –ü–†–û–§–ò–õ–¨
        </div>
    </nav>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const fbConfig = {
        apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw",
        authDomain: "auna-jewel.firebaseapp.com",
        projectId: "auna-jewel",
        storageBucket: "auna-jewel.appspot.com",
    };

    const firebaseApp = initializeApp(fbConfig);
    const db = getFirestore(firebaseApp);
    const tg = window.Telegram.WebApp;

    Vue.createApp({
        data() {
            return {
                activeTab: 'catalog',
                burgerOpen: false,
                currentCategory: '–í—Å–µ',
                selP: null,
                activeSize: 'Uni',
                isAdmin: false,
                adminId: 387881523,
                user: { first_name: '–ì–æ—Å—Ç—å', photo: null },
                products: [
                    { id: 1, category: '–∫–æ–º–ª–µ–∫—Ç—ã', name: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º —á–µ—Ä–Ω—ã–π', price: 2900, images: ['1.jpg'], sizes: ['42','44'], selS: '42', aIdx: 0, desc: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º.' },
                    { id: 2, category: '—Å–µ—Ä—å–≥–∏', name: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º –±–æ—Ä–¥–æ–≤—ã–π', price: 2900, images: ['2.jpg'], sizes: ['42','44'], selS: '42', aIdx: 0, desc: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º.' }
                ],
                cart: JSON.parse(localStorage.getItem('auna_cart') || '[]'),
                currentInfo: null,
                loading: false,
                infoData: {
                    about: { title: "AUNA Jewel", text: "–≠—Ç–æ —É–∫—Ä–∞—à–µ–Ω–∏—è —Å –¥—É—à–æ–π. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –∫–∞–º–Ω–∏, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Ñ—É—Ä–Ω–∏—Ç—É—Ä—É –∏ —Ä—É—á–Ω—É—é —Å–±–æ—Ä–∫—É." },
                    delivery: { title: "–î–æ—Å—Ç–∞–≤–∫–∞", text: "–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –°–î–≠–ö –∏ –ü–æ—á—Ç–æ–π –ø–æ –≤—Å–µ–π –†–§. –°–∞–º–æ–≤—ã–≤–æ–∑ –≤–æ–∑–º–æ–∂–µ–Ω –ø–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏." },
                    return: { title: "–í–æ–∑–≤—Ä–∞—Ç", text: "–ï—Å–ª–∏ —É–∫—Ä–∞—à–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–æ—à–ª–æ, –≤—ã –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π." }
                },
                newP: { name: '', price: '', desc: '', cat: '–°–µ—Ä—å–≥–∏', images: [] },
                form: { name: '', phone: '', address: '' },
                map: null,
                marker: null
            }
        },
        computed: {
            filteredProducts() {
                let res = this.products;
                if (!this.isAdmin) res = res.filter(p => !p.hidden);
                if (this.currentCategory !== '–í—Å–µ') res = res.filter(p => p.category === this.currentCategory);
                return res;
            },
            cartTotal() { return this.cart.reduce((s, i) => s + Number(i.price), 0); }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            openInfo(id) { this.currentInfo = id; this.burgerOpen = false; this.vibrate(); },
            addToCart(p) {
                this.cart.push({...p, selectedSize: this.activeSize});
                localStorage.setItem('auna_cart', JSON.stringify(this.cart));
                tg.showAlert("–î–æ–±–∞–≤–ª–µ–Ω–æ!");
                this.selP = null;
            },
            removeFromCart(i) { this.cart.splice(i, 1); localStorage.setItem('auna_cart', JSON.stringify(this.cart)); },
            async uploadToImgBB(e) {
                const files = e.target.files; this.loading = true;
                for (let f of files) {
                    const fd = new FormData(); fd.append("image", f);
                    const r = await fetch("https://api.imgbb.com/1/upload?key=839e62907e9a52f0159461b7771bcb2f", {method:"POST", body:fd});
                    const d = await r.json(); this.newP.images.push(d.data.url);
                }
                this.loading = false;
            },
            async saveProduct() {
                await addDoc(collection(db, "products"), {...this.newP, createdAt: Date.now(), hidden: false, sizes: ['Uni']});
                this.newP = { name: '', price: '', desc: '', cat: '–°–µ—Ä—å–≥–∏', images: [] };
                tg.showAlert("–ì–æ—Ç–æ–≤–æ!");
            },
            async toggleHide(p) { await updateDoc(doc(db, "products", p.id), { hidden: !p.hidden }); },
            contactSupport() { tg.openTelegramLink('https://t.me/opttania'); },
            initMap() {
                setTimeout(() => {
                    if (this.map) return;
                    this.map = new mapgl.Map('map', { center: [37.61, 55.75], zoom: 12, key: 'cab82c94-e619-42eb-9814-3361712feaf0' });
                    
                    this.map.on('click', (e) => {
                        const coords = e.lngLat;
                        if (this.marker) this.marker.destroy();
                        this.marker = new mapgl.Marker(this.map, { coordinates: coords });
                        
                        fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lon=${coords[0]}&lat=${coords[1]}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                        .then(r => r.json()).then(data => {
                            if (data.result?.items?.length > 0) {
                                this.form.address = data.result.items[0].full_name || data.result.items[0].name;
                                this.vibrate();
                            }
                        });
                    });
                }, 400);
            },
            sendOrder() {
                const items = this.cart.map(i => `‚Ä¢ ${i.name} (${i.selectedSize})`).join('\n');
                const text = `üíé –ù–û–í–´–ô –ó–ê–ö–ê–ó\n–ò–º—è: ${this.form.name}\n–¢–µ–ª: ${this.form.phone}\n–ü—É–Ω–∫—Ç: ${this.form.address}\n\n–¢–æ–≤–∞—Ä—ã:\n${items}\n\n–ò–¢–û–ì–û: ${this.cartTotal}‚ÇΩ`;
                tg.sendData(text);
                this.cart = []; localStorage.removeItem('auna_cart');
            }
        },
        watch: {
            activeTab(v) { if (v === 'cart') this.initMap(); }
        },
        mounted() {
            tg.ready(); tg.expand();
            if (tg.initDataUnsafe?.user) {
                const u = tg.initDataUnsafe.user;
                this.user = { first_name: u.first_name, photo: u.photo_url };
                this.form.name = u.first_name;
                if (Number(u.id) === Number(this.adminId)) this.isAdmin = true;
            }

            onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), (snap) => {
                this.products = snap.docs.map(d => {
                    const data = d.data();
                    const displayImage = (data.images && data.images.length > 0) ? data.images[0] : (data.img || 'https://via.placeholder.com/400?text=AUNA');
                    return { id: d.id, ...data, displayImage };
                });
            });
        }
    }).mount('#app');
</script>
</body>
</html>
