<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUNA jewel</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw", authDomain: "auna-jewel.firebaseapp.com", projectId: "auna-jewel" };
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.fb = { collection, addDoc, onSnapshot, updateDoc, doc };
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --accent: #1a1a1a; --pink: #fdf0f3; --text: #2c2c2c; --gray: #9e9e9e; }
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: #fff; color: var(--text); user-select: none; }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 70px; background: #fff; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--gray); font-size: 10px; transition: 0.3s; }
        .nav-item.active { color: var(--accent); transform: translateY(-2px); }
        .nav-item svg { width: 24px; height: 24px; }

        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .catalog-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; padding-bottom: 100px; }
        .product-card { background: #f9f9f9; border-radius: 20px; overflow: hidden; position: relative; }
        .product-card img { width: 100%; height: 210px; object-fit: cover; }
        .heart-btn { position: absolute; top: 12px; right: 12px; background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; color: white; border: 1px solid rgba(255,255,255,0.3); }
        .heart-btn.active { color: #ff4757; background: #fff; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–≤ –¥–µ—Ç–∞–ª—è—Ö) */
        .details-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 2000; overflow-y: auto; }
        .size-btn { border: 1px solid #ddd; padding: 10px 15px; border-radius: 10px; background: none; font-family: inherit; font-weight: 600; transition: 0.2s; }
        .size-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

        /* –ö–∞—Ä—Ç–∞ */
        #map { width: 100%; height: 250px; border-radius: 15px; margin: 15px 0; }

        .btn-black { background: var(--accent); color: #fff; border: none; padding: 18px; width: 100%; border-radius: 15px; font-weight: 700; margin-top: 10px; }
        
        .burger-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 3000; padding: 30px; }
        [v-cloak] { display: none; }
    </style>
</head>
<body>

<div id="app" v-cloak>
    <header style="padding: 15px; text-align: center; border-bottom: 1px solid #eee; position: sticky; top:0; background: #fff; z-index: 500;">
        <div @click="ui.burger = true; vibro('light')" style="position: absolute; left: 15px; font-size: 20px;">‚ò∞</div>
        <h1 style="margin: 0; font-size: 14px; letter-spacing: 3px; font-weight: 700;">AUNA jewel</h1>
    </header>

    <div v-if="ui.burger" class="burger-menu">
        <div @click="ui.burger = false" style="font-size: 30px; margin-bottom: 40px;">‚úï</div>
        <div @click="openInfo('–û –ù–ê–°', 'AUNA jewel ‚Äî —ç—Ç–æ –ø—Ä–æ —ç—Å—Ç–µ—Ç–∏–∫—É –∏ –∫–∞—á–µ—Å—Ç–≤–æ –≤ –∫–∞–∂–¥–æ–π –¥–µ—Ç–∞–ª–∏.')" style="font-size: 20px; margin-bottom: 25px; font-weight: 600;">–û –ù–ê–°</div>
        <div @click="openInfo('–î–û–°–¢–ê–í–ö–ê', '–î–æ—Å—Ç–∞–≤–∫–∞ –°–î–≠–ö, –ü–æ—á—Ç–∞ –†–§ –∏ 5post –ø–æ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–µ.')" style="font-size: 20px; margin-bottom: 25px; font-weight: 600;">–î–û–°–¢–ê–í–ö–ê</div>
        <div @click="openInfo('–í–û–ó–í–†–ê–¢', '–í–æ–∑–≤—Ä–∞—Ç —É–∫—Ä–∞—à–µ–Ω–∏–π –≤–æ–∑–º–æ–∂–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π.')" style="font-size: 20px; font-weight: 600;">–í–û–ó–í–†–ê–¢</div>
    </div>

    <div v-if="activeTab === 'catalog'">
        <div style="display: flex; gap: 10px; padding: 15px; overflow-x: auto;">
            <button v-for="cat in ['–í—Å–µ', '–°–µ—Ä—å–≥–∏', '–¶–µ–ø–æ—á–∫–∏']" @click="ui.cat = cat; vibro('light')" :class="['size-btn', ui.cat === cat ? 'active' : '']" style="padding: 5px 15px; font-size: 12px;">{{cat}}</button>
        </div>
        <div class="catalog-grid">
            <div v-for="p in filteredProducts" :key="p.id" class="product-card" @click="openProduct(p)">
                <img :src="p.images[0]">
                <div class="heart-btn" :class="{active: isFav(p)}" @click.stop="toggleFav(p)">‚ù§</div>
                <div style="padding: 12px;">
                    <div style="font-size: 12px; margin-bottom: 4px;">{{p.name}}</div>
                    <div style="font-weight: 700;">{{p.price}} ‚ÇΩ</div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="activeTab === 'fav'">
        <h2 style="padding: 15px 15px 0;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
        <div v-if="favs.length === 0" style="padding: 30px; text-align: center; color: var(--gray);">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</div>
        <div class="catalog-grid">
            <div v-for="p in favs" :key="p.id" class="product-card" @click="openProduct(p)">
                <img :src="p.images[0]">
                <div style="padding: 12px;">
                    <div style="font-size: 12px;">{{p.name}}</div>
                    <div style="font-weight: 700;">{{p.price}} ‚ÇΩ</div>
                </div>
            </div>
        </div>
    </div>

    <div v-show="activeTab === 'cart'" style="padding: 15px; padding-bottom: 120px;">
        <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
        <div v-if="cart.length === 0" style="text-align: center; color: var(--gray); padding: 40px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
        <div v-else>
            <div v-for="(item, idx) in cart" :key="idx" style="display: flex; gap: 15px; margin-bottom: 15px; background: #f9f9f9; padding: 10px; border-radius: 15px;">
                <img :src="item.images[0]" style="width: 70px; height: 70px; border-radius: 10px; object-fit: cover;">
                <div style="flex: 1;">
                    <div style="font-weight: 600; font-size: 14px;">{{item.name}}</div>
                    <div style="font-size: 12px; color: var(--gray);">–†–∞–∑–º–µ—Ä: {{item.selSize}}</div>
                    <div style="font-weight: 700; margin-top: 5px;">{{item.price}} ‚ÇΩ</div>
                </div>
                <div @click="removeFromCart(idx)" style="color: #ff4757;">‚úï</div>
            </div>
            
            <div style="margin-top: 30px;">
                <input v-model="form.name" placeholder="–í–∞—à–µ –∏–º—è" style="width:100%; padding:15px; border-radius:12px; border:1px solid #eee; margin-bottom:10px;">
                <input v-model="form.phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (10-11 —Ü–∏—Ñ—Ä)" type="tel" style="width:100%; padding:15px; border-radius:12px; border:1px solid #eee; margin-bottom:15px;">
                
                <p style="font-weight: 600; margin-bottom: 10px;">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏:</p>
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <button v-for="m in ['–°–î–≠–ö', '–ü–æ—á—Ç–∞', '5post']" @click="form.method = m; vibro('light')" :class="['size-btn', form.method === m ? 'active' : '']" style="flex: 1;">{{m}}</button>
                </div>
                
                <div id="map"></div>
                <button class="btn-black" @click="checkout">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
            </div>
        </div>
    </div>

    <div v-if="activeTab === 'profile'" style="padding: 20px;">
        <div style="text-align: center; margin-bottom: 30px;">
            <img :src="user.photo || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px;">
            <h3 style="margin: 0;">{{user.first_name}}</h3>
            <div @click="openSupport" style="color: var(--gray); margin-top: 10px;">–ü–æ–¥–¥–µ—Ä–∂–∫–∞: @opttania</div>
        </div>

        <div v-if="isAdmin" style="background: #fdf0f3; padding: 20px; border-radius: 20px;">
            <h3 style="margin-top: 0;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
            <input v-model="newItem.name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; margin-bottom:10px;">
            <textarea v-model="newItem.desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; margin-bottom:10px;"></textarea>
            <input v-model="newItem.price" type="number" placeholder="–¶–µ–Ω–∞" style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; margin-bottom:10px;">
            <input type="file" @change="handleFileUpload" style="margin-bottom:10px;">
            <button class="btn-black" @click="addProduct">–î–û–ë–ê–í–ò–¢–¨ –í –ö–ê–¢–ê–õ–û–ì</button>
        </div>
    </div>

    <div v-if="selectedP" class="details-page">
        <div @click="selectedP = null" style="padding: 20px; font-size: 25px;">‚úï</div>
        <div style="display: flex; overflow-x: auto; scroll-snap-type: x mandatory; height: 400px;">
            <img v-for="img in selectedP.images" :src="img" style="min-width: 100%; object-fit: cover; scroll-snap-align: start;">
        </div>
        <div style="padding: 25px;">
            <h2 style="margin: 0 0 10px;">{{selectedP.name}}</h2>
            <div style="font-size: 22px; font-weight: 700; margin-bottom: 20px;">{{selectedP.price}} ‚ÇΩ</div>
            <p style="color: #666; line-height: 1.6; margin-bottom: 30px;">{{selectedP.desc}}</p>
            
            <p style="font-weight: 700; margin-bottom: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä:</p>
            <div style="display: flex; gap: 10px; margin-bottom: 30px;">
                <button v-for="s in selectedP.sizes" @click="form.selSize = s; vibro('light')" :class="['size-btn', form.selSize === s ? 'active' : '']">{{s}}</button>
            </div>
            
            <button class="btn-black" @click="addToCart(selectedP)">–î–û–ë–ê–í–ò–¢–¨ –í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div v-for="tab in tabs" :key="tab.id" @click="setTab(tab.id)" :class="['nav-item', activeTab === tab.id ? 'active' : '']">
            <svg viewBox="0 0 24 24" fill="currentColor" v-html="tab.icon"></svg>
            <span>{{tab.name}}</span>
        </div>
    </nav>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const IMGBB_KEY = '839e62907e9a52f0159461b7771bcb2f';

    const { createApp } = Vue;
    createApp({
        data() {
            return {
                activeTab: 'catalog',
                isAdmin: true, adminId: 387881523, // –í–ê–® ID
                user: { first_name: '–ì–æ—Å—Ç—å', photo: '' },
                products: [
                {id: 1, name: '–ö–æ–º–ø–ª–µ–∫—Ç—ã', price: 4500, category: '–ö–æ–º–ø–ª–µ–∫—Ç—ã', images: ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '6.jpg'], sizes: ['40—Å–º', '45—Å–º'], hidden: false},
                {id: 2, name: '–¶–µ–ø—å "Gold"', price: 2500, category: '–¶–µ–ø–æ—á–∫–∏', images: ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '6.jpg'], sizes: ['40—Å–º', '45—Å–º'], hidden: false}
                ],
                cart: JSON.parse(localStorage.getItem('auna_cart') || '[]'),
                favs: JSON.parse(localStorage.getItem('auna_favs') || '[]'),
                selectedP: null,
                ui: { burger: false, cat: '–í—Å–µ' },
                form: { name: '', phone: '', method: '–°–î–≠–ö', selSize: '' },
                newItem: { name: '', desc: '', price: '', images: [], category: '–°–µ—Ä—å–≥–∏' },
                tabs: [
                    { id: 'catalog', name: '–ö–∞—Ç–∞–ª–æ–≥', icon: '<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>' },
                    { id: 'fav', name: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', icon: '<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>' },
                    { id: 'cart', name: '–ö–æ—Ä–∑–∏–Ω–∞', icon: '<path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>' },
                    { id: 'profile', name: '–ü—Ä–æ—Ñ–∏–ª—å', icon: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08s5.97 1.09 6 3.08c-1.29 1.94-3.5 3.22-6 3.22z"/>' }
                ]
            }
        },
        computed: {
            filteredProducts() {
                if (this.ui.cat === '–í—Å–µ') return this.products;
                return this.products.filter(p => p.category === this.ui.cat);
            }
        },
        methods: {
            vibro(type = 'medium') { tg.HapticFeedback.impactOccurred(type); },
            setTab(id) { this.vibro('light'); this.activeTab = id; if(id === 'cart') this.initMap(); },
            openProduct(p) { this.vibro('medium'); this.selectedP = p; this.form.selSize = p.sizes ? p.sizes[0] : '42'; },
            isFav(p) { return this.favs.some(f => f.id === p.id); },
            toggleFav(p) {
                this.vibro('light');
                const idx = this.favs.findIndex(f => f.id === p.id);
                if(idx > -1) this.favs.splice(idx, 1);
                else this.favs.push(p);
                localStorage.setItem('auna_favs', JSON.stringify(this.favs));
            },
            addToCart(p) {
                this.vibro('medium');
                this.cart.push({ ...p, selSize: this.form.selSize });
                localStorage.setItem('auna_cart', JSON.stringify(this.cart));
                this.selectedP = null;
                tg.showAlert('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É! ‚ú®');
            },
            removeFromCart(idx) { this.cart.splice(idx, 1); localStorage.setItem('auna_cart', JSON.stringify(this.cart)); },
            async handleFileUpload(e) {
                const file = e.target.files[0];
                const formData = new FormData();
                formData.append('image', file);
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: 'POST', body: formData });
                const data = await res.json();
                this.newItem.images.push(data.data.url);
                tg.showAlert('–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! ‚úÖ');
            },
            async addProduct() {
                if(!this.newItem.name || !this.newItem.price) return;
                await window.fb.addDoc(window.fb.collection(window.db, "products"), {
                    ...this.newItem,
                    sizes: ['16', '17', '18'],
                    hidden: false,
                    createdAt: Date.now()
                });
                tg.showAlert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É! üíé');
                this.newItem = { name: '', desc: '', price: '', images: [], category: '–°–µ—Ä—å–≥–∏' };
            },
            checkout() {
                const phone = this.form.phone.replace(/\D/g, '');
                if(phone.length < 10 || phone.length > 11) {
                    tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (10-11 —Ü–∏—Ñ—Ä)');
                    return;
                }
                this.vibro('success');
                const orderData = `üì¶ –ó–ê–ö–ê–ó: ${this.cart.map(i => i.name + ' (' + i.selSize + ')').join(', ')}\nüí∞ –ò–¢–û–ì–û: ${this.cart.reduce((s,i)=>s+Number(i.price),0)} ‚ÇΩ\nüë§ –ò–ú–Ø: ${this.form.name}\nüìû –¢–ï–õ: ${this.form.phone}\nüöö –î–û–°–¢–ê–í–ö–ê: ${this.form.method}`;
                tg.sendData(orderData);
                this.cart = [];
                localStorage.removeItem('auna_cart');
                setTimeout(() => { tg.close(); }, 100);
            },
            initMap() {
                setTimeout(() => {
                    const map = new mapgl.Map('map', { center: [37.6176, 55.7558], zoom: 13, key: 'cab82c94-e619-42eb-9814-3361712feaf0' });
                    navigator.geolocation.getCurrentPosition(pos => {
                        map.setCenter([pos.coords.longitude, pos.coords.latitude]);
                    });
                }, 100);
            },
            openInfo(title, text) { tg.showPopup({ title, message: text }); },
            openSupport() { tg.openTelegramLink('https://t.me/opttania'); }
        },
        mounted() {
            tg.ready(); tg.expand();
            if(tg.initDataUnsafe?.user) {
                this.user = { first_name: tg.initDataUnsafe.user.first_name, photo: tg.initDataUnsafe.user.photo_url };
                this.form.name = tg.initDataUnsafe.user.first_name;
                if(Number(tg.initDataUnsafe.user.id) === this.adminId) this.isAdmin = true;
            }
            // –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏–∑ Firebase
            setTimeout(() => {
                const q = window.fb.collection(window.db, "products");
                window.fb.onSnapshot(q, (snapshot) => {
                    this.products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                });
            }, 1000);
        }
    }).mount('#app');
</script>
</body>
</html>
