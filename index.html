<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUNA jewel | Premium Shop</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #000000;
            --bg: #ffffff;
            --card-bg: #fdfdfd;
            --text-main: #1a1a1a;
            --text-muted: #8e8e93;
            --error: #ff3b30;
            --success: #34c759;
            --border: #f0f0f0;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            overflow-x: hidden;
            padding-bottom: 120px;
        }

        [v-cloak] { display: none; }

        /* HEADER */
        header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            z-index: 1000;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-weight: 900;
            font-size: 18px;
            letter-spacing: 6px;
            text-transform: uppercase;
            margin: 0;
        }

        /* BURGER MENU */
        .burger-menu {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 2000;
            padding: 60px 30px;
            transform: translateX(-100%);
            transition: 0.5s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .burger-menu.active { transform: translateX(0); }
        .burger-close { font-size: 35px; margin-bottom: 40px; font-weight: 300; }
        .burger-item { 
            font-size: 28px; 
            font-weight: 800; 
            margin-bottom: 30px; 
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* INFO PAGES */
        .info-page {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 4000;
            padding: 40px 25px;
            overflow-y: auto;
        }
        .info-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            font-weight: 800;
            text-transform: uppercase;
        }

        /* CATALOG */
        .categories {
            display: flex;
            gap: 12px;
            padding: 20px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .categories::-webkit-scrollbar { display: none; }
        .category-tab {
            padding: 10px 22px;
            border-radius: 30px;
            background: #f5f5f7;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            transition: 0.4s;
            border: 1px solid transparent;
        }
        .category-tab.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .catalog {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 0 20px;
        }
        .product-card {
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow);
            transition: 0.3s;
        }
        .product-card:active { transform: scale(0.96); }
        
        .product-image-container {
            width: 100%;
            aspect-ratio: 1/1.2;
            position: relative;
            background: #f0f0f0;
        }
        .product-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .heart-icon {
            position: absolute;
            top: 12px; right: 12px;
            z-index: 10;
            width: 36px; height: 36px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }
        .heart-icon svg { width: 18px; height: 18px; fill: none; stroke: #000; stroke-width: 2px; }
        .heart-icon.active svg { fill: #ff3b30; stroke: #ff3b30; }

        .product-info { padding: 15px; }
        .product-name { font-size: 14px; font-weight: 700; margin-bottom: 5px; color: #333; }
        .product-price { font-weight: 900; font-size: 16px; color: #000; }

        /* MODAL */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 3000;
            overflow-y: auto;
        }
        .close-modal {
            position: absolute; top: 25px; right: 25px; z-index: 100;
            width: 40px; height: 40px; background: rgba(0,0,0,0.05);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 20px;
        }
        .slider-container {
            width: 100%;
            height: 65vh;
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            background: #fafafa;
        }
        .slider-container img { min-width: 100%; object-fit: cover; scroll-snap-align: start; }

        /* CART */
        .cart-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #fff;
            border-radius: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            align-items: center;
        }
        .cart-item img { width: 90px; height: 90px; border-radius: 15px; object-fit: cover; }

        .input-group { margin-bottom: 20px; }
        .input-group label { 
            display: block; font-size: 11px; font-weight: 800; 
            margin-bottom: 8px; text-transform: uppercase; color: var(--text-muted);
        }
        .input-group input, .input-group textarea, .input-group select {
            width: 100%; padding: 16px; border: 1px solid var(--border); 
            border-radius: 15px; font-family: inherit; font-size: 14px;
            background: #fbfbfb;
        }

        .delivery-btns { display: flex; gap: 10px; margin-bottom: 20px; }
        .delivery-btn {
            flex: 1; padding: 15px; border: 1px solid var(--border);
            border-radius: 15px; font-weight: 700; font-size: 13px; text-align: center;
        }
        .delivery-btn.active { background: black; color: white; border-color: black; }

        #map { width: 100%; height: 220px; border-radius: 20px; margin-bottom: 25px; border: 1px solid var(--border); }

        /* NAVIGATION */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px); display: flex; justify-content: space-around; 
            padding: 15px 10px 35px; border-top: 1px solid var(--border); z-index: 1500;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 6px; color: var(--text-muted); font-size: 11px; font-weight: 600; position: relative; }
        .nav-item.active { color: var(--accent); }
        .nav-item svg { width: 26px; height: 26px; }
        .badge { position: absolute; top: -5px; right: -5px; background: var(--error); color: white; font-size: 10px; padding: 3px 7px; border-radius: 12px; font-weight: 800; }

        /* ADMIN */
        .admin-section {
            background: #fff;
            border: 2px solid #000;
            border-radius: 25px;
            padding: 25px;
            margin-top: 40px;
        }
        .admin-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; background: #f9f9f9; border-radius: 15px; margin-bottom: 10px;
        }

        .btn-main {
            width: 100%; padding: 20px; background: black; color: white; border-radius: 18px;
            border: none; font-weight: 800; font-size: 16px; transition: 0.3s;
        }
        .btn-main:active { transform: scale(0.97); }

    </style>
</head>
<body>

<div id="app" v-cloak>
    
    <header>
        <div @click="burgerOpen = true; vibrate()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </div>
        <h1 class="logo">AUNA jewel</h1>
        <div style="width:28px"></div>
    </header>

    <div class="burger-menu" :class="{active: burgerOpen}">
        <div class="burger-close" @click="burgerOpen = false; vibrate()">‚úï</div>
        <div class="burger-item" @click="showInfoPage('about')">–ò—Å—Ç–æ—Ä–∏—è –±—Ä–µ–Ω–¥–∞</div>
        <div class="burger-item" @click="showInfoPage('delivery')">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</div>
        <div class="burger-item" @click="showInfoPage('return')">–£—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞</div>
        <div class="burger-item" @click="contactSupport()">–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏</div>
    </div>

    <div class="info-page" v-if="currentInfoPage">
        <div class="info-header" @click="currentInfoPage = null; vibrate()">
            <span>‚Üê –ù–∞–∑–∞–¥</span>
        </div>
        <h1 style="font-weight: 900; font-size: 32px; margin-bottom: 20px;">{{ infoData[currentInfoPage].title }}</h1>
        <div style="line-height: 1.8; font-size: 15px; color: #444; white-space: pre-line;">
            {{ infoData[currentInfoPage].content }}
        </div>
        <button class="btn-main" style="margin-top: 40px;" @click="currentInfoPage = null">–ü–û–ù–Ø–¢–ù–û</button>
    </div>

    <main>
        <div v-if="activeTab === 'catalog'">
            <div class="categories">
                <div v-for="cat in ['–í—Å–µ', '–°–µ—Ä—å–≥–∏', '–¶–µ–ø–æ—á–∫–∏', '–ö–æ–ª—å—Ü–∞', '–ë—Ä–∞—Å–ª–µ—Ç—ã']" 
                     @click="currentCategory = cat; vibrate()" 
                     :class="['category-tab', currentCategory === cat ? 'active' : '']">
                    {{ cat }}
                </div>
            </div>

            <div class="catalog">
                <div v-for="product in filteredProducts" :key="product.id" class="product-card" @click="openProduct(product); vibrate()">
                    <div class="product-image-container">
                        <div class="heart-icon" :class="{active: isFavorite(product)}" @click.stop="toggleFavorite(product); vibrate()">
                            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        </div>
                        <img :src="getProductImage(product)">
                        <div v-if="product.hidden && isAdmin" style="position:absolute; bottom:0; width:100%; background:red; color:white; font-size:10px; text-align:center; padding:2px; font-weight:800;">–°–ö–†–´–¢</div>
                    </div>
                    <div class="product-info">
                        <div class="product-name">{{ product.name }}</div>
                        <div class="product-price">{{ product.price }} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'favorites'" style="padding: 20px">
            <h1 style="font-weight: 900; margin-bottom: 25px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h1>
            <div v-if="favorites.length === 0" style="text-align:center; padding: 100px 0;">
                <p style="color: #bbb; font-weight: 600;">–í—ã –µ—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏</p>
            </div>
            <div class="catalog">
                <div v-for="p in favorites" :key="p.id" class="product-card" @click="openProduct(p)">
                    <img :src="getProductImage(p)" style="width:100%; aspect-ratio:1/1.2; object-fit:cover;">
                    <div class="product-info">
                        <div class="product-name">{{ p.name }}</div>
                        <div class="product-price">{{ p.price }} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-show="activeTab === 'cart'" style="padding: 20px">
            <h1 style="font-weight: 900; margin-bottom: 25px;">–í–∞—à –∑–∞–∫–∞–∑</h1>
            <div v-if="cart.length === 0" style="text-align:center; padding: 80px 0;">
                <p style="color: #bbb; font-weight: 600;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                <button class="btn-main" @click="activeTab = 'catalog'" style="width:auto; padding: 15px 40px; margin-top: 20px;">–í –ö–ê–¢–ê–õ–û–ì</button>
            </div>
            <div v-else>
                <div v-for="(item, index) in cart" :key="index" class="cart-item">
                    <img :src="getProductImage(item)">
                    <div style="flex:1">
                        <div style="font-weight: 800; font-size: 15px;">{{ item.name }}</div>
                        <div style="font-size: 12px; color: #888; margin: 4px 0;">–†–∞–∑–º–µ—Ä: {{ item.selectedSize }}</div>
                        <div style="font-weight: 900; font-size: 16px;">{{ item.price }} ‚ÇΩ</div>
                    </div>
                    <div @click="removeFromCart(index); vibrate()" style="padding: 10px; color: #ff3b30; font-weight: 800;">‚úï</div>
                </div>

                <div style="margin-top: 40px; background: #fff; padding: 20px; border-radius: 25px; box-shadow: var(--shadow);">
                    <h3 style="margin-bottom: 20px; font-weight: 800;">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
                    <div class="input-group"><label>–í–∞—à–µ –∏–º—è</label><input v-model="orderForm.name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"></div>
                    <div class="input-group"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input v-model="orderForm.phone" type="tel" placeholder="7 900 000-00-00"></div>
                    <div class="input-group">
                        <label>–î–æ—Å—Ç–∞–≤–∫–∞</label>
                        <div class="delivery-btns">
                            <div v-for="m in ['–°–î–≠–ö', '–ü–æ—á—Ç–∞', '5Post']" :class="['delivery-btn', orderForm.delivery === m ? 'active' : '']" @click="orderForm.delivery = m; vibrate()">{{m}}</div>
                        </div>
                    </div>
                    <div id="map"></div>
                    <button class="btn-main" @click="processOrder">–û–ü–õ–ê–¢–ò–¢–¨ {{ cartTotal }} ‚ÇΩ</button>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'profile'" style="padding: 25px">
            <div style="text-align:center; margin-bottom: 40px">
                <div style="position:relative; display:inline-block;">
                    <img :src="user.photo || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" style="width: 110px; height: 110px; border-radius: 50%; border: 4px solid #f0f0f0; padding: 5px;">
                </div>
                <h2 style="font-weight: 900; margin: 15px 0 5px;">{{ user.first_name }}</h2>
                <p style="color: #999; font-size: 12px; font-weight: 600;">–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç AUNA</p>
                <button class="btn-main" @click="contactSupport" style="background:#f5f5f7; color:#000; padding:12px 25px; font-size:12px; width:auto; margin-top:20px; box-shadow:none;">–°–õ–£–ñ–ë–ê –ü–û–î–î–ï–†–ñ–ö–ò</button>
            </div>

            <div v-if="isAdmin" class="admin-section">
                <h2 style="font-weight: 900; text-align:center; margin-bottom: 25px; letter-spacing: 2px;">ADMIN PANEL</h2>
                
                <div class="input-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑–¥–µ–ª–∏—è</label><input v-model="newP.name"></div>
                <div class="input-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea v-model="newP.desc" rows="3"></textarea></div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="input-group"><label>–¶–µ–Ω–∞</label><input v-model="newP.price" type="number"></div>
                    <div class="input-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select v-model="newP.cat">
                            <option v-for="c in ['–°–µ—Ä—å–≥–∏', '–¶–µ–ø–æ—á–∫–∏', '–ö–æ–ª—å—Ü–∞', '–ë—Ä–∞—Å–ª–µ—Ç—ã']">{{c}}</option>
                        </select>
                    </div>
                </div>
                <div class="input-group"><label>–†–∞–∑–º–µ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label><input v-model="newP.sizes" placeholder="16, 17, 18"></div>
                
                <div class="input-group">
                    <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</label>
                    <input type="file" @change="handleUpload" multiple style="border:none; background:none; padding:0;">
                    <div style="display:flex; gap:10px; margin-top:10px; overflow-x:auto;">
                        <img v-for="img in newP.images" :src="img" style="width:60px; height:60px; border-radius:10px; object-fit:cover;">
                    </div>
                </div>

                <button class="btn-main" @click="addDocFirebase" :disabled="uploading">
                    {{ uploading ? '–ó–ê–ì–†–£–ó–ö–ê...' : '–î–û–ë–ê–í–ò–¢–¨ –í –ö–ê–¢–ê–õ–û–ì' }}
                </button>

                <h3 style="margin: 40px 0 20px; font-weight: 800;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ ({{products.length}})</h3>
                <div v-for="p in products" :key="p.id" class="admin-item">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <img :src="getProductImage(p)" style="width:40px; height:40px; border-radius:8px; object-fit:cover;">
                        <span style="font-size:12px; font-weight:700;">{{ p.name }}</span>
                    </div>
                    <button @click="toggleVisible(p); vibrate()" 
                            :style="{background: p.hidden ? '#ff3b30':'#34c759', color:'white', border:'none', padding:'8px 15px', borderRadius:'10px', fontWeight:'800', fontSize:'10px'}">
                        {{ p.hidden ? '–°–ö–†–´–¢':'–í–ò–î–ï–ù' }}
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div class="modal" v-if="selP">
        <div class="close-modal" @click="selP = null">‚úï</div>
        <div class="slider-container">
            <img v-for="img in selP.images" :src="img">
        </div>
        <div style="padding: 30px;">
            <div style="font-weight: 800; color: #bbb; font-size: 11px; text-transform: uppercase; letter-spacing: 2px;">{{ selP.category }}</div>
            <h1 style="font-size: 28px; font-weight: 900; margin: 10px 0 15px;">{{ selP.name }}</h1>
            <div style="font-size: 24px; font-weight: 900; color: #000;">{{ selP.price }} ‚ÇΩ</div>
            
            <div style="margin: 30px 0;">
                <label style="font-weight: 800; font-size: 11px; text-transform: uppercase;">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä:</label>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <div v-for="s in selP.sizes" 
                         :class="['delivery-btn', activeS === s ? 'active' : '']" 
                         @click="activeS = s; vibrate()">
                        {{s}}
                    </div>
                </div>
            </div>

            <p style="line-height: 1.8; color: #666; font-size: 15px;">{{ selP.description }}</p>
            
            <button class="btn-main" @click="pushToCart(selP)" style="margin-top:40px; height:70px;">–î–û–ë–ê–í–ò–¢–¨ –í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item" :class="{active: activeTab === 'catalog'}" @click="activeTab = 'catalog'; vibrate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </div>
        <div class="nav-item" :class="{active: activeTab === 'favorites'}" @click="activeTab = 'favorites'; vibrate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </div>
        <div class="nav-item" :class="{active: activeTab === 'cart'}" @click="activeTab = 'cart'; vibrate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
            <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
            <span v-if="cart.length" class="badge">{{ cart.length }}</span>
        </div>
        <div class="nav-item" :class="{active: activeTab === 'profile'}" @click="activeTab = 'profile'; vibrate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            <span>–ö–∞–±–∏–Ω–µ—Ç</span>
        </div>
    </nav>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const config = {
        apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw",
        authDomain: "auna-jewel.firebaseapp.com",
        projectId: "auna-jewel",
        storageBucket: "auna-jewel.appspot.com",
    };

    const firebase = initializeApp(config);
    const db = getFirestore(firebase);
    const tg = window.Telegram.WebApp;

    Vue.createApp({
        data() {
            return {
                activeTab: 'catalog',
                burgerOpen: false,
                currentCategory: '–í—Å–µ',
                selP: null,
                activeS: null,
                isAdmin: false,
                adminId: 387881523,
                user: { first_name: '–ì–æ—Å—Ç—å', photo: null },
                products: [],
                favorites: JSON.parse(localStorage.getItem('auna_favs') || '[]'),
                cart: JSON.parse(localStorage.getItem('auna_cart') || '[]'),
                uploading: false,
                currentInfoPage: null,
                infoData: {
                    about: { title: "AUNA jewel", content: "–ú—ã —Å–æ–∑–¥–∞–µ–º —É–∫—Ä–∞—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —á–∞—Å—Ç—å—é –≤–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏. \n\n–ë—Ä–µ–Ω–¥ AUNA –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –≤ 2023 –≥–æ–¥—É —Å –∏–¥–µ–µ–π –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–∏—Ä–æ–¥–Ω—É—é —ç—Å—Ç–µ—Ç–∏–∫—É –∫–∞–º–Ω–µ–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∏–Ω–∏–º–∞–ª–∏–∑–º. –ù–∞—à–∏ –∏–∑–¥–µ–ª–∏—è –∏–∑–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –∏–∑ —Å–µ—Ä–µ–±—Ä–∞ 925 –ø—Ä–æ–±—ã –∏ –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–π —Ñ—É—Ä–Ω–∏—Ç—É—Ä—ã. \n\n–ú—ã –≤–µ—Ä–∏–º, —á—Ç–æ —É–∫—Ä–∞—à–µ–Ω–∏—è ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∞–∫—Å–µ—Å—Å—É–∞—Ä, –∞ —Å–ø–æ—Å–æ–± –≤—ã—Ä–∞–∑–∏—Ç—å —Å–≤–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ —Å–ª–æ–≤." },
                    delivery: { title: "–î–æ—Å—Ç–∞–≤–∫–∞", content: "–ú—ã –¥–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ –≤—Å–µ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–§ –∏ –°–ù–ì.\n\n‚Äî –°–î–≠–ö (–ü–í–ó –∏–ª–∏ –ö—É—Ä—å–µ—Ä): 3-5 –¥–Ω–µ–π.\n‚Äî –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏ (–ü–µ—Ä–≤—ã–π –∫–ª–∞—Å—Å): 5-10 –¥–Ω–µ–π.\n‚Äî 5Post (–í—ã–¥–∞—á–∞ –≤ –ü—è—Ç–µ—Ä–æ—á–∫–µ): 3-7 –¥–Ω–µ–π.\n\n–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è." },
                    return: { title: "–í–æ–∑–≤—Ä–∞—Ç", content: "–í—ã –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å —É–∫—Ä–∞—à–µ–Ω–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –ø–æ–¥–æ—à–ª–æ. \n\n–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è: \n1. –ò–∑–¥–µ–ª–∏–µ –Ω–µ –±—ã–ª–æ –≤ –Ω–æ—Å–∫–µ.\n2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞ –∏ –±–∏—Ä–∫–∞.\n3. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è.\n\n–°—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç—É –≤ —Ç–µ—á–µ–Ω–∏–µ 3-—Ö —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–º–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞." }
                },
                newP: { name: '', desc: '', price: '', cat: '–°–µ—Ä—å–≥–∏', sizes: '', images: [], hidden: false },
                orderForm: { name: '', phone: '', delivery: '–°–î–≠–ö' }
            }
        },
        computed: {
            filteredProducts() {
                let res = this.products;
                if (!this.isAdmin) res = res.filter(p => !p.hidden);
                if (this.currentCategory !== '–í—Å–µ') res = res.filter(p => p.category === this.currentCategory);
                return res;
            },
            cartTotal() { return this.cart.reduce((s, i) => s + Number(i.price), 0); }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            showInfoPage(page) { this.currentInfoPage = page; this.burgerOpen = false; this.vibrate(); },
            openProduct(p) { this.selP = p; this.activeS = p.sizes[0]; },
            getProductImage(p) {
                if (p.images && p.images.length > 0) return p.images[0];
                return p.img || 'https://via.placeholder.com/400?text=AUNA';
            },
            toggleFavorite(p) {
                const idx = this.favorites.findIndex(f => f.id === p.id);
                if (idx > -1) this.favorites.splice(idx, 1);
                else this.favorites.push(p);
                localStorage.setItem('auna_favs', JSON.stringify(this.favorites));
            },
            isFavorite(p) { return this.favorites.some(f => f.id === p.id); },
            pushToCart(p) {
                this.cart.push({...p, selectedSize: this.activeS});
                localStorage.setItem('auna_cart', JSON.stringify(this.cart));
                tg.showAlert("–ò–∑–¥–µ–ª–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!");
                this.selP = null;
            },
            removeFromCart(i) { this.cart.splice(i, 1); localStorage.setItem('auna_cart', JSON.stringify(this.cart)); },
            async handleUpload(e) {
                const files = e.target.files; this.uploading = true;
                for (let file of files) {
                    const fd = new FormData(); fd.append("image", file);
                    try {
                        const r = await fetch("https://api.imgbb.com/1/upload?key=839e62907e9a52f0159461b7771bcb2f", { method: "POST", body: fd });
                        const d = await r.json();
                        this.newP.images.push(d.data.url);
                    } catch (err) { console.error("Upload error"); }
                }
                this.uploading = false;
            },
            async addDocFirebase() {
                if (!this.newP.name || !this.newP.price) return tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ!");
                const data = {
                    name: this.newP.name,
                    description: this.newP.desc,
                    price: Number(this.newP.price),
                    category: this.newP.cat,
                    sizes: this.newP.sizes.split(',').map(s => s.trim()),
                    images: this.newP.images,
                    hidden: false,
                    createdAt: Date.now()
                };
                await addDoc(collection(db, "products"), data);
                this.newP = { name: '', desc: '', price: '', cat: '–°–µ—Ä—å–≥–∏', sizes: '', images: [], hidden: false };
                tg.showAlert("–£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!");
            },
            async toggleVisible(p) { await updateDoc(doc(db, "products", p.id), { hidden: !p.hidden }); },
            contactSupport() { tg.openTelegramLink('https://t.me/opttania'); },
            processOrder() {
                if (this.orderForm.phone.length < 10) return tg.showAlert("–£–∫–∞–∂–∏—Ç–µ –≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä!");
                const items = this.cart.map(i => `‚Ä¢ ${i.name} [${i.selectedSize}]`).join('\n');
                const msg = `üíç –ù–û–í–´–ô –ó–ê–ö–ê–ó\n\nüë§ –ò–º—è: ${this.orderForm.name}\nüìû –¢–µ–ª: ${this.orderForm.phone}\nüöö –î–æ—Å—Ç–∞–≤–∫–∞: ${this.orderForm.delivery}\n\nüì¶ –ò–∑–¥–µ–ª–∏—è:\n${items}\n\nüí∞ –ò—Ç–æ–≥–æ: ${this.cartTotal}‚ÇΩ`;
                tg.sendData(msg);
                this.cart = []; localStorage.removeItem('auna_cart');
            },
            loadMap() {
                setTimeout(() => {
                    const mapEl = document.getElementById('map');
                    if (!mapEl) return;
                    mapEl.innerHTML = "";
                    const map = new mapgl.Map('map', { center: [37.61, 55.75], zoom: 12, key: 'cab82c94-e619-42eb-9814-3361712feaf0' });
                    navigator.geolocation.getCurrentPosition(pos => {
                        const coords = [pos.coords.longitude, pos.coords.latitude];
                        map.setCenter(coords);
                        new mapgl.Marker(map, { coordinates: coords });
                    });
                }, 500);
            }
        },
        watch: {
            activeTab(v) { if (v === 'cart') this.loadMap(); }
        },
        mounted() {
            tg.ready(); tg.expand();
            if (tg.initDataUnsafe?.user) {
                const u = tg.initDataUnsafe.user;
                this.user = { first_name: u.first_name, photo: u.photo_url, id: u.id };
                this.orderForm.name = u.first_name;
                if (Number(u.id) === Number(this.adminId)) this.isAdmin = true;
            }
            onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), (s) => {
                this.products = s.docs.map(d => ({ 
                    id: d.id, 
                    ...d.data(),
                    images: d.data().images || (d.data().img ? [d.data().img] : [])
                }));
            });
        }
    }).mount('#app');
</script>
</body>
</html>
