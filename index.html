<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUNA jewel</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #2c2c2c; --bg: #ffffff; --gray: #f4f4f4; }
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: var(--bg); color: var(--accent); overflow-x: hidden; }
        
        /* Сетка 2 ряда */
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; padding-bottom: 100px; }
        .card { background: var(--gray); border-radius: 18px; overflow: hidden; position: relative; transition: transform 0.2s; }
        .card:active { transform: scale(0.98); }
        .card img { width: 100%; height: 190px; object-fit: cover; }
        
        /* Прозрачное сердце */
        .fav-icon { position: absolute; top: 10px; right: 10px; z-index: 10; font-size: 24px; color: rgba(255,255,255,0.8); cursor: pointer; }
        .fav-icon.active { color: #ff4444; }

        /* Навигация (Иконки) */
        .tab-bar { position: fixed; bottom: 0; width: 100%; height: 70px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .tab-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #aaa; }
        .tab-item.active { color: var(--accent); font-weight: 600; }
        .tab-item svg { width: 24px; height: 24px; margin-bottom: 4px; }

        /* Кнопки размеров */
        .size-container { display: flex; gap: 8px; margin: 15px 0; overflow-x: auto; }
        .size-btn { padding: 10px 18px; border: 1.5px solid #ddd; border-radius: 12px; background: white; font-weight: 600; }
        .size-btn.active { border-color: var(--accent); background: var(--accent); color: white; }

        .btn-main { background: var(--accent); color: white; border: none; padding: 16px; width: 100%; border-radius: 14px; font-weight: 600; margin-top: 10px; }
        #map { width: 100%; height: 220px; border-radius: 15px; margin: 15px 0; }
        
        /* Бургер */
        .burger-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2000; padding: 40px 20px; }
    </style>
</head>
<body>
<div id="app">
    <header style="padding: 15px; text-align: center; border-bottom: 1px solid #eee; position: sticky; top: 0; background: white; z-index: 100;">
        <div @click="ui.burger = true; vibro()" style="position: absolute; left: 15px; font-size: 20px;">☰</div>
        <h1 style="margin: 0; font-size: 16px; letter-spacing: 2px;">AUNA jewel</h1>
    </header>

    <div v-if="ui.burger" class="burger-menu">
        <div @click="ui.burger = false" style="text-align: right; font-size: 24px;">✕</div>
        <div @click="showInfo('О нас', 'AUNA jewel - это стиль и качество.')" style="padding: 20px 0; border-bottom: 1px solid #eee;">О НАС</div>
        <div @click="showInfo('Возврат', 'Срок возврата - 14 дней.')" style="padding: 20px 0; border-bottom: 1px solid #eee;">ВОЗВРАТ</div>
        <div @click="showInfo('Доставка', 'Мы доставляем по всему миру.')" style="padding: 20px 0;">ДОСТАВКА</div>
    </div>

    <div v-if="activeTab === 'catalog'">
        <div style="display: flex; gap: 10px; padding: 10px; overflow-x: auto;">
            <div v-for="cat in ['Серьги', 'Цепочки', 'Кольца']" @click="category = cat; vibro()" :class="['size-btn', category === cat ? 'active' : '']" style="padding: 6px 15px; font-size: 12px;">{{cat}}</div>
        </div>
        <div class="products-grid">
            <div v-for="p in filteredProducts" :key="p.id" class="card" @click="openP(p)" v-if="!p.hidden">
                <div class="fav-icon" :class="{active: isFav(p)}" @click.stop="toggleFav(p)">♥</div>
                <img :src="p.images[0]">
                <div style="padding: 10px; font-size: 13px;">
                    <div>{{p.name}}</div>
                    <div style="font-weight: 700; margin-top: 4px;">{{p.price}} ₽</div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="activeTab === 'cart'" style="padding: 15px;">
        <div v-if="cart.length > 0">
            <div v-for="item in cart" style="display:flex; gap:10px; margin-bottom:10px;">
                <img :src="item.images[0]" style="width:50px; height:50px; border-radius:8px;">
                <div>{{item.name}} ({{item.selectedSize}}) - {{item.price}}₽</div>
            </div>
            <input v-model="form.name" placeholder="Имя" class="btn-main" style="background:#f9f9f9; color:black; text-align:left;">
            <input v-model="form.phone" placeholder="Телефон (10-11 цифр)" class="btn-main" style="background:#f9f9f9; color:black; text-align:left;">
            <p>Доставка:</p>
            <div style="display:flex; gap:5px;">
                <button v-for="d in ['Сдэк','Почта','5post']" @click="form.delivery = d; vibro()" :class="['size-btn', form.delivery === d ? 'active' : '']">{{d}}</button>
            </div>
            <div id="map"></div>
            <button class="btn-main" @click="checkout">Оформить заказ</button>
        </div>
        <div v-else style="text-align:center; padding-top:50px;">Корзина пуста</div>
    </div>

    <div v-if="activeTab === 'profile'" style="padding: 20px;">
        <div style="text-align: center; margin-bottom: 20px;">
            <img :src="user.photo || 'https://via.placeholder.com/80'" style="width:80px; border-radius:50%;">
            <h3>{{user.first_name}}</h3>
        </div>
        <button class="btn-main" @click="tgSupport">Поддержка (opttania)</button>
        
        <div v-if="isAdmin" style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px;">
            <h3>Админ-панель</h3>
            <input v-model="newItem.name" placeholder="Название" class="btn-main" style="background:#f4f4f4; color:black; text-align:left;">
            <input v-model="newItem.price" placeholder="Цена" class="btn-main" style="background:#f4f4f4; color:black; text-align:left;">
            <input type="file" @change="uploadPhoto" style="margin-top:10px;">
            <button class="btn-main" @click="saveProduct">Добавить товар</button>
        </div>
    </div>

    <div v-if="viewP" style="position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:3000; overflow-y:auto;">
        <div @click="viewP = null" style="padding:20px; font-size:24px;">✕</div>
        <div style="display:flex; overflow-x:auto; height:350px;">
            <img v-for="img in viewP.images" :src="img" style="min-width:100%; object-fit:cover;">
        </div>
        <div style="padding:20px;">
            <h2>{{viewP.name}}</h2>
            <p>{{viewP.description}}</p>
            <div class="size-container">
                <button v-for="s in viewP.sizes" @click="selS = s; vibro()" :class="['size-btn', selS === s ? 'active' : '']">{{s}}</button>
            </div>
            <button class="btn-main" @click="addToCart(viewP)">Добавить в корзину</button>
        </div>
    </div>

    <nav class="tab-bar">
        <div v-for="t in nav" @click="activeTab = t.id; vibro(); if(t.id === 'cart') initMap()" :class="['tab-item', activeTab === t.id ? 'active' : '']">
            <svg viewBox="0 0 24 24" fill="currentColor" v-html="t.icon"></svg>
            <span>{{t.title}}</span>
        </div>
    </nav>
</div>

<script>
const tg = window.Telegram.WebApp;
Vue.createApp({
    data() {
        return {
            activeTab: 'catalog',
            category: 'Серьги',
            viewP: null, selS: null,
            isAdmin: true, adminId: 'ВАШ_ID',
            user: { first_name: 'Гость', photo: '' },
            ui: { burger: false },
            newItem: { name: '', price: '', images: [], sizes: ['42','44','46'] },
            cart: JSON.parse(localStorage.getItem('auna_cart') || '[]'),
            favs: JSON.parse(localStorage.getItem('auna_favs') || '[]'),
            form: { name: '', phone: '', delivery: 'Сдэк' },
            products: [
                { id: 1, name: 'Серьги Луна', price: 2500, category: 'Серьги', images: ['1.jpg'], sizes: ['16','17','18'], description: 'Сияющие серьги ручной работы.' }
            ],
            nav: [
                { id: 'catalog', title: 'Каталог', icon: '<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>' },
                { id: 'fav', title: 'Избранное', icon: '<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>' },
                { id: 'cart', title: 'Корзина', icon: '<path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>' },
                { id: 'profile', title: 'Профиль', icon: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08s5.97 1.09 6 3.08c-1.29 1.94-3.5 3.22-6 3.22z"/>' }
            ]
        }
    },
    computed: {
        filteredProducts() { return this.products.filter(p => p.category === this.category); }
    },
    methods: {
        vibro() { tg.HapticFeedback.impactOccurred('medium'); },
        openP(p) { this.vibro(); this.viewP = p; this.selS = p.sizes[0]; },
        isFav(p) { return this.favs.some(f => f.id === p.id); },
        toggleFav(p) {
            this.vibro();
            const idx = this.favs.findIndex(f => f.id === p.id);
            if (idx > -1) this.favs.splice(idx, 1);
            else this.favs.push(p);
            localStorage.setItem('auna_favs', JSON.stringify(this.favs));
        },
        addToCart(p) {
            this.cart.push({ ...p, selectedSize: this.selS });
            localStorage.setItem('auna_cart', JSON.stringify(this.cart));
            this.viewP = null;
            tg.showAlert('Добавлено в корзину!');
        },
        async uploadPhoto(e) { /* Тот код, что я дал выше */ },
        checkout() {
            const phone = this.form.phone.replace(/\D/g, '');
            if (phone.length < 10 || phone.length > 11) {
                tg.showAlert('Номер телефона должен содержать 10-11 цифр!');
                return;
            }
            tg.sendData(`Заказ от ${this.form.name}, Тел: ${this.form.phone}`);
            this.cart = [];
            localStorage.removeItem('auna_cart');
        },
        initMap() {
            setTimeout(() => {
                const map = new mapgl.Map('map', { center: [37.6176, 55.7558], zoom: 12, key: 'cab82c94-e619-42eb-9814-3361712feaf0' });
            }, 500);
        }
    },
    mounted() {
        tg.ready(); tg.expand();
        if (tg.initDataUnsafe?.user) {
            this.user = { first_name: tg.initDataUnsafe.user.first_name, photo: tg.initDataUnsafe.user.photo_url };
            this.form.name = tg.initDataUnsafe.user.first_name;
        }
    }
}).mount('#app');
</script>
</body>
</html>
