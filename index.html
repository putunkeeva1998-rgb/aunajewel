<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUNA jewel</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw", 
            authDomain: "auna-jewel.firebaseapp.com", 
            projectId: "auna-jewel" 
        };
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.fbMethods = { collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc };
    </script>

    <style>
        :root { 
            --accent: #1a1a1a; 
            --bg: #ffffff; 
            --card-bg: #f9f9f9;
            --dark: #000000; 
            --gray: #e0e0e0; 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); font-family: 'Montserrat', sans-serif; color: var(--dark); }

        .header { padding: 15px; text-align: center; border-bottom: 1px solid var(--gray); position: sticky; top: 0; background: #fff; z-index: 100; }
        .header h1 { margin: 0; font-size: 16px; letter-spacing: 3px; text-transform: uppercase; }

        /* Сетка каталога */
        .catalog-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; padding-bottom: 100px; }
        .card { background: var(--card-bg); border-radius: 15px; overflow: hidden; position: relative; }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        
        /* Таб-бар */
        .tab-bar { position: fixed; bottom: 0; width: 100%; height: 70px; background: #fff; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--gray); z-index: 1000; }
        .tab-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #888; }
        .tab-item.active { color: var(--accent); }
        .tab-item svg { width: 24px; height: 24px; margin-bottom: 4px; }

        /* Админка */
        .admin-box { background: #f0f0f0; padding: 15px; border-radius: 15px; margin-top: 20px; border: 1px dashed #000; }
        .admin-input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #ccc; font-family: inherit; }
        .btn-black { background: #000; color: #fff; border: none; padding: 15px; width: 100%; border-radius: 12px; font-weight: 700; cursor: pointer; }
        .manage-item { display: flex; align-items: center; justify-content: space-between; background: #fff; padding: 10px; border-radius: 10px; margin-top: 8px; }

        /* Иконка сердца */
        .fav-btn { position: absolute; top: 10px; right: 10px; color: rgba(255,255,255,0.8); font-size: 20px; }
        .fav-btn.active { color: #ff4757; }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <h1>AUNA jewel</h1>
    </div>

    <div v-if="activeTab === 'catalog'" class="catalog-grid">
        <div v-for="p in products" :key="p.id" class="card" v-if="!p.hidden" @click="openProduct(p)">
            <img :src="p.images[0]">
            <div class="fav-btn" :class="{active: isFav(p)}" @click.stop="toggleFav(p)">❤</div>
            <div style="padding: 10px;">
                <div style="font-size: 13px; font-weight: 600;">{{p.name}}</div>
                <div style="font-weight: 800; margin-top: 5px;">{{p.price}} ₽</div>
            </div>
        </div>
    </div>

    <div v-if="activeTab === 'profile'" style="padding: 15px; padding-bottom: 100px;">
        <div style="text-align: center; margin-bottom: 20px;">
            <img :src="user.photo" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px;">
            <h2 style="margin: 0;">{{user.first_name}}</h2>
            <button @click="contactSupport" class="btn-black" style="margin-top: 15px; background: #444;">Написать в поддержку</button>
        </div>

        <div v-if="isAdmin" class="admin-box">
            <h3 style="margin-top: 0;">Админ-панель</h3>
            <input v-model="newItem.name" placeholder="Название товара" class="admin-input">
            <input v-model="newItem.price" placeholder="Цена" class="admin-input">
            <textarea v-model="newItem.desc" placeholder="Описание" class="admin-input"></textarea>
            <input type="file" @change="uploadPhoto" style="margin-bottom: 15px;">
            <button @click="saveProduct" class="btn-black">ДОБАВИТЬ ТОВАР</button>

            <h4 style="margin-top: 25px;">Управление витриной:</h4>
            <div v-for="p in products" :key="p.id" class="manage-item">
                <span style="font-size: 12px; font-weight: 600;">{{p.name}}</span>
                <button @click="toggleHide(p)" 
                        :style="{background: p.hidden ? '#ff4757' : '#2ed573', color: '#fff', border: 'none', padding: '5px 10px', borderRadius: '5px'}">
                    {{ p.hidden ? 'ПОКАЗАТЬ' : 'СКРЫТЬ' }}
                </button>
            </div>
        </div>
    </div>

    <nav class="tab-bar">
        <div v-for="t in tabs" :key="t.id" @click="activeTab = t.id; vibrate()" :class="['tab-item', activeTab === t.id ? 'active' : '']">
            <svg viewBox="0 0 24 24" fill="currentColor" v-html="t.icon"></svg>
            <span>{{t.label}}</span>
        </div>
    </nav>
</div>

<script>
    const tg = window.Telegram.WebApp;

    Vue.createApp({
        data() {
            return {
                activeTab: 'catalog',
                isAdmin: false,
                adminId: 387881523, // ВАШ ID
                user: { first_name: 'Гость', photo: '' },
                products: [
                {id: 1, name: 'Комплекты', price: 4500, category: 'Комплекты', images: ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '6.jpg'], sizes: ['40см', '45см'], hidden: false},
                {id: 2, name: 'Цепь "Gold"', price: 2500, category: 'Цепочки', images: ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '6.jpg'], sizes: ['40см', '45см'], hidden: false}
            ],
                favs: JSON.parse(localStorage.getItem('auna_favs') || '[]'),
                newItem: { name: '', price: '', desc: '', images: [], category: 'Серьги' },
                tabs: [
                    { id: 'catalog', label: 'Каталог', icon: '<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>' },
                    { id: 'fav', label: 'Избранное', icon: '<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>' },
                    { id: 'cart', label: 'Корзина', icon: '<path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>' },
                    { id: 'profile', label: 'Профиль', icon: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08s5.97 1.09 6 3.08c-1.29 1.94-3.5 3.22-6 3.22z"/>' }
                ]
            }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            
            async uploadPhoto(e) {
                const file = e.target.files[0];
                const formData = new FormData();
                formData.append('image', file);
                
                const res = await fetch('https://api.imgbb.com/1/upload?key=839e62907e9a52f0159461b7771bcb2f', {
                    method: 'POST',
                    body: formData
                });
                const result = await res.json();
                this.newItem.images.push(result.data.url);
                tg.showAlert('Фото загружено в ImgBB!');
            },

            async saveProduct() {
                if(!this.newItem.name || this.newItem.images.length === 0) return;
                await window.fbMethods.addDoc(window.fbMethods.collection(window.db, "products"), {
                    ...this.newItem,
                    hidden: false,
                    sizes: ['16', '17', '18'],
                    createdAt: Date.now()
                });
                tg.showAlert('Товар добавлен!');
                this.newItem = { name: '', price: '', desc: '', images: [], category: 'Серьги' };
            },

            async toggleHide(p) {
                this.vibrate();
                const productRef = window.fbMethods.doc(window.db, "products", p.id);
                await window.fbMethods.updateDoc(productRef, { hidden: !p.hidden });
            },

            isFav(p) { return this.favs.some(f => f.id === p.id); },
            toggleFav(p) {
                this.vibrate();
                const idx = this.favs.findIndex(f => f.id === p.id);
                if(idx > -1) this.favs.splice(idx, 1);
                else this.favs.push(p);
                localStorage.setItem('auna_favs', JSON.stringify(this.favs));
            },
            contactSupport() { tg.openTelegramLink('https://t.me/opttania'); }
        },
        mounted() {
            tg.ready();
            tg.expand();
            if(tg.initDataUnsafe?.user) {
                this.user = { first_name: tg.initDataUnsafe.user.first_name, photo: tg.initDataUnsafe.user.photo_url };
                if(Number(tg.initDataUnsafe.user.id) === this.adminId) this.isAdmin = true;
            }

            // Загрузка товаров из Firebase
            setTimeout(() => {
                const q = window.fbMethods.query(window.fbMethods.collection(window.db, "products"), window.fbMethods.orderBy("createdAt", "desc"));
                window.fbMethods.onSnapshot(q, (snapshot) => {
                    this.products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                });
            }, 1000);
        }
    }).mount('#app');
</script>
</body>
</html>
