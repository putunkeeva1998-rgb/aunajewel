<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUNA jewel | Premium Shop</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #000000;
            --bg: #ffffff;
            --card-bg: #fdfdfd;
            --text-main: #1a1a1a;
            --text-muted: #8e8e93;
            --error: #ff3b30;
            --success: #34c759;
            --border: #f0f0f0;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            overflow-x: hidden;
            padding-bottom: 120px;
        }

        [v-cloak] { display: none; }

        /* HEADER */
        header {
            position: sticky; top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            z-index: 1000;
            padding: 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .logo { font-weight: 900; font-size: 18px; letter-spacing: 6px; text-transform: uppercase; margin: 0; }

        /* BURGER MENU */
        .burger-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 2000; padding: 60px 30px;
            transform: translateX(-100%); transition: 0.5s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .burger-menu.active { transform: translateX(0); }
        .burger-close { font-size: 35px; margin-bottom: 40px; cursor: pointer; font-weight: 300; }
        .burger-item { font-size: 26px; font-weight: 800; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; }

        /* INFO PAGES (–û –ù–ê–° / –î–û–°–¢–ê–í–ö–ê) */
        .info-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 4000; padding: 40px 25px; overflow-y: auto;
        }
        .info-header { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; font-weight: 800; cursor: pointer; }

        /* CATALOG CATEGORIES */
        .categories { display: flex; gap: 12px; padding: 20px; overflow-x: auto; scrollbar-width: none; }
        .categories::-webkit-scrollbar { display: none; }
        .category-tab {
            padding: 10px 22px; border-radius: 30px; background: #f5f5f7;
            font-size: 13px; font-weight: 600; white-space: nowrap; transition: 0.4s;
        }
        .category-tab.active { background: var(--accent); color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* PRODUCT GRID */
        .catalog { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; }
        .product-card { background: var(--card-bg); border-radius: 20px; overflow: hidden; position: relative; box-shadow: var(--shadow); transition: 0.3s; }
        .product-card:active { transform: scale(0.97); }
        
        .product-image-container { width: 100%; aspect-ratio: 1/1.2; background: #f0f0f0; position: relative; }
        .product-image-container img { width: 100%; height: 100%; object-fit: cover; }

        .heart-icon {
            position: absolute; top: 12px; right: 12px; z-index: 10;
            width: 36px; height: 36px; background: rgba(255,255,255,0.8);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .heart-icon svg { width: 18px; height: 18px; fill: none; stroke: #000; stroke-width: 2px; }
        .heart-icon.active svg { fill: #ff3b30; stroke: #ff3b30; }

        .product-info { padding: 15px; }
        .product-name { font-size: 14px; font-weight: 700; margin-bottom: 5px; color: #333; height: 34px; overflow: hidden; }
        .product-price { font-weight: 900; font-size: 16px; color: #000; }

        /* MODAL PRODUCT DETAIL */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 3000; overflow-y: auto; }
        .close-modal { position: absolute; top: 25px; right: 25px; z-index: 100; width: 40px; height: 40px; background: rgba(0,0,0,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .slider-container { width: 100%; height: 65vh; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; background: #fafafa; }
        .slider-container img { min-width: 100%; object-fit: cover; scroll-snap-align: start; }

        /* CART & ORDER FORM */
        .cart-item { display: flex; gap: 20px; padding: 20px; background: #fff; border-radius: 20px; margin-bottom: 15px; box-shadow: var(--shadow); align-items: center; }
        .cart-item img { width: 85px; height: 85px; border-radius: 15px; object-fit: cover; }

        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 11px; font-weight: 800; margin-bottom: 8px; text-transform: uppercase; color: var(--text-muted); }
        .input-group input, .input-group textarea, .input-group select {
            width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 15px; font-family: inherit; font-size: 14px; background: #fbfbfb;
        }

        #map-container {
            position: relative; width: 100%; height: 300px; margin: 15px 0 25px;
            border-radius: 20px; overflow: hidden; border: 1px solid var(--border); z-index: 5;
        }
        #map { width: 100%; height: 100%; }
        .address-box { background: #f5f5f7; padding: 15px; border-radius: 15px; font-size: 13px; line-height: 1.5; margin-bottom: 25px; border-left: 4px solid #000; }

        .delivery-btns { display: flex; gap: 10px; margin-bottom: 20px; }
        .delivery-btn { flex: 1; padding: 15px; border: 1px solid var(--border); border-radius: 15px; font-weight: 700; font-size: 12px; text-align: center; }
        .delivery-btn.active { background: black; color: white; border-color: black; }

        /* BUTTONS */
        .btn-main { width: 100%; padding: 20px; background: black; color: white; border-radius: 18px; border: none; font-weight: 800; font-size: 16px; transition: 0.3s; }
        .btn-main:active { transform: scale(0.96); }

        /* NAVIGATION BAR */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px); display: flex; justify-content: space-around; 
            padding: 15px 10px 35px; border-top: 1px solid var(--border); z-index: 1500;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 6px; color: var(--text-muted); font-size: 11px; font-weight: 600; position: relative; }
        .nav-item.active { color: var(--accent); }
        .nav-item svg { width: 26px; height: 26px; }
        .badge { position: absolute; top: -5px; right: -5px; background: var(--error); color: white; font-size: 10px; padding: 3px 7px; border-radius: 12px; font-weight: 800; }

        /* ADMIN SECTION */
        .admin-box { background: #fff; border: 2px solid #000; border-radius: 25px; padding: 25px; margin-top: 40px; }
        .admin-item-list { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 12px; margin-bottom: 8px; }

    </style>
</head>
<body>

<div id="app" v-cloak>
    
    <header>
        <div @click="burgerOpen = true; vibrate()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </div>
        <h1 class="logo">AUNA jewel</h1>
        <div style="width:28px"></div>
    </header>

    <div class="burger-menu" :class="{active: burgerOpen}">
        <div class="burger-close" @click="burgerOpen = false; vibrate()">‚úï</div>
        <div class="burger-item" @click="openInfo('about')">–û –±—Ä–µ–Ω–¥–µ</div>
        <div class="burger-item" @click="openInfo('delivery')">–î–æ—Å—Ç–∞–≤–∫–∞</div>
        <div class="burger-item" @click="openInfo('return')">–í–æ–∑–≤—Ä–∞—Ç</div>
        <div class="burger-item" @click="contactSupport">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
    </div>

    <div class="info-page" v-if="currentInfo">
        <div class="info-header" @click="currentInfo = null; vibrate()">‚Üê –ù–ê–ó–ê–î</div>
        <h1 style="font-weight: 900; font-size: 30px; margin-bottom: 25px;">{{ infoData[currentInfo].title }}</h1>
        <div style="line-height: 1.8; font-size: 15px; white-space: pre-line;">{{ infoData[currentInfo].text }}</div>
    </div>

    <main>
        <div v-if="activeTab === 'catalog'">
            <div class="categories">
                <div v-for="cat in ['–í—Å–µ', '–°–µ—Ä—å–≥–∏', '–¶–µ–ø–æ—á–∫–∏', '–ö–æ–ª—å—Ü–∞', '–ë—Ä–∞—Å–ª–µ—Ç—ã']" 
                     @click="currentCategory = cat; vibrate()" 
                     :class="['category-tab', currentCategory === cat ? 'active' : '']">
                    {{ cat }}
                </div>
            </div>

            <div class="catalog">
                <div v-for="product in filteredProducts" :key="product.id" class="product-card" @click="openProduct(product); vibrate()">
                    <div class="product-image-container">
                        <div class="heart-icon" :class="{active: isFavorite(product)}" @click.stop="toggleFavorite(product); vibrate()">
                            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        </div>
                        <img :src="product.images ? product.images[0] : product.img" @error="e => e.target.src='https://via.placeholder.com/400?text=AUNA'">
                    </div>
                    <div class="product-info">
                        <div class="product-name">{{ product.name }}</div>
                        <div class="product-price">{{ product.price }} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-show="activeTab === 'cart'" style="padding: 20px">
            <h1 style="font-weight: 900; margin-bottom: 25px;">–ö–æ—Ä–∑–∏–Ω–∞</h1>
            
            <div v-if="cart.length === 0" style="text-align:center; padding: 100px 0;">
                <p style="color: #bbb; font-weight: 600;">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                <button class="btn-main" @click="activeTab = 'catalog'" style="width:auto; padding: 15px 30px; margin-top: 20px;">–ü–ï–†–ï–ô–¢–ò –ö –ü–û–ö–£–ü–ö–ê–ú</button>
            </div>
            
            <div v-else>
                <div v-for="(item, index) in cart" :key="index" class="cart-item">
                    <img :src="item.images ? item.images[0] : item.img">
                    <div style="flex:1">
                        <div style="font-weight: 800;">{{ item.name }}</div>
                        <div style="font-size: 12px; color: #888;">–†–∞–∑–º–µ—Ä: {{ item.selectedSize }}</div>
                        <div style="font-weight: 900;">{{ item.price }} ‚ÇΩ</div>
                    </div>
                    <div @click="removeFromCart(index); vibrate()" style="color:red; font-weight: 800; padding: 10px;">‚úï</div>
                </div>

                <div style="margin-top: 40px; background: white; padding: 25px; border-radius: 25px; box-shadow: var(--shadow);">
                    <h3 style="font-weight: 900; margin-bottom: 20px;">–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
                    <div class="input-group"><label>–í–∞—à–µ –∏–º—è</label><input v-model="orderForm.name" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"></div>
                    <div class="input-group"><label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω</label><input v-model="orderForm.phone" type="tel" placeholder="7 900 000-00-00"></div>
                    
                    <label style="font-size: 11px; font-weight: 800; color: #888;">–í–´–ë–ï–†–ò–¢–ï –ü–£–ù–ö–¢ –ù–ê –ö–ê–†–¢–ï:</label>
                    <div id="map-container">
                        <div id="map"></div>
                    </div>
                    
                    <div class="address-box">
                        <strong>–ê–î–†–ï–° –ü–û–õ–£–ß–ï–ù–ò–Ø:</strong><br>
                        {{ orderForm.address || '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏' }}
                    </div>

                    <button class="btn-main" @click="sendOrder">–û–ü–õ–ê–¢–ò–¢–¨ {{ cartTotal }} ‚ÇΩ</button>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'favorites'" style="padding: 20px">
            <h1 style="font-weight: 900; margin-bottom: 25px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h1>
            <div v-if="favorites.length === 0" style="text-align:center; padding: 100px 0; color: #bbb;">–ù–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ</div>
            <div class="catalog">
                <div v-for="p in favorites" :key="p.id" class="product-card" @click="openProduct(p)">
                    <img :src="p.images ? p.images[0] : p.img" style="width:100%; aspect-ratio:1/1.2; object-fit:cover;">
                    <div class="product-info">
                        <div class="product-name">{{ p.name }}</div>
                        <div class="product-price">{{ p.price }} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'profile'" style="padding: 25px">
            <div style="text-align:center; margin-bottom: 40px">
                <img :src="user.photo || 'https://via.placeholder.com/100'" style="width:100px; height:100px; border-radius:50%; border: 3px solid #eee; padding: 5px;">
                <h2 style="font-weight: 900; margin: 15px 0;">{{ user.first_name }}</h2>
                <button class="btn-main" @click="contactSupport" style="background:#f5f5f7; color:#000; font-size:12px; width:auto; padding: 12px 25px;">–ü–û–ú–û–©–¨</button>
            </div>

            <div v-if="isAdmin" class="admin-box">
                <h2 style="font-weight: 900; text-align:center; letter-spacing: 2px;">–ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨</h2>
                
                <div class="input-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input v-model="newP.name"></div>
                <div class="input-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea v-model="newP.desc" rows="3"></textarea></div>
                <div class="input-group"><label>–¶–µ–Ω–∞</label><input v-model="newP.price" type="number"></div>
                <div class="input-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select v-model="newP.cat">
                        <option>–°–µ—Ä—å–≥–∏</option><option>–¶–µ–ø–æ—á–∫–∏</option><option>–ö–æ–ª—å—Ü–∞</option><option>–ë—Ä–∞—Å–ª–µ—Ç—ã</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (—á–µ—Ä–µ–∑ ImgBB)</label>
                    <input type="file" @change="uploadToImgBB" multiple>
                    <div style="display:flex; gap:10px; margin-top:10px; overflow-x:auto;">
                        <img v-for="img in newP.images" :src="img" style="width:50px; height:50px; border-radius:8px; object-fit:cover;">
                    </div>
                </div>

                <button class="btn-main" @click="saveToFirebase" :disabled="uploading">
                    {{ uploading ? '–ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û...' : '–°–û–•–†–ê–ù–ò–¢–¨ –¢–û–í–ê–†' }}
                </button>

                <h3 style="margin-top: 40px; font-weight: 800;">–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤:</h3>
                <div v-for="p in products" :key="p.id" class="admin-item-list">
                    <span style="font-size:12px; font-weight:700;">{{ p.name }}</span>
                    <button @click="toggleHide(p)" :style="{background: p.hidden ? 'red':'green', color:'white', border:'none', padding:'6px 12px', borderRadius:'8px', fontSize:'10px'}">
                        {{ p.hidden ? '–°–ö–†–´–¢':'–í–ò–î–ï–ù' }}
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div class="modal" v-if="selP">
        <div class="close-modal" @click="selP = null">‚úï</div>
        <div class="slider-container">
            <img v-for="img in selP.images" :src="img">
        </div>
        <div style="padding: 30px;">
            <div style="font-weight: 800; color: #bbb; font-size: 11px; text-transform: uppercase;">{{ selP.category }}</div>
            <h1 style="font-size: 26px; font-weight: 900; margin: 10px 0;">{{ selP.name }}</h1>
            <div style="font-size: 24px; font-weight: 900;">{{ selP.price }} ‚ÇΩ</div>
            <p style="line-height: 1.8; color: #555; margin: 25px 0;">{{ selP.description }}</p>
            
            <label style="font-weight: 800; font-size: 11px;">–í–´–ë–ï–†–ò–¢–ï –†–ê–ó–ú–ï–†:</label>
            <div style="display:flex; gap:10px; margin: 15px 0 30px;">
                <div v-for="s in selP.sizes" :class="['delivery-btn', activeSize === s ? 'active' : '']" @click="activeSize = s">{{s}}</div>
            </div>
            
            <button class="btn-main" @click="addToCart(selP)">–í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item" :class="{active: activeTab === 'catalog'}" @click="activeTab = 'catalog'; vibrate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            –ú–∞–≥–∞–∑–∏–Ω
        </div>
        <div class="nav-item" :class="{active: activeTab === 'favorites'}" @click="activeTab = 'favorites'; vibrate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        </div>
        <div class="nav-item" :class="{active: activeTab === 'cart'}" @click="activeTab = 'cart'; vibrate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
            –ö–æ—Ä–∑–∏–Ω–∞ <span v-if="cart.length" class="badge">{{ cart.length }}</span>
        </div>
        <div class="nav-item" :class="{active: activeTab === 'profile'}" @click="activeTab = 'profile'; vibrate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            –ü—Ä–æ—Ñ–∏–ª—å
        </div>
    </nav>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const fbCfg = {
        apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw",
        authDomain: "auna-jewel.firebaseapp.com",
        projectId: "auna-jewel",
        storageBucket: "auna-jewel.appspot.com",
    };

    const firebase = initializeApp(fbCfg);
    const db = getFirestore(firebase);
    const tg = window.Telegram.WebApp;

    Vue.createApp({
        data() {
            return {
                activeTab: 'catalog',
                burgerOpen: false,
                currentCategory: '–í—Å–µ',
                selP: null,
                activeSize: null,
                isAdmin: false,
                adminId: 387881523,
                user: { first_name: '–ì–æ—Å—Ç—å', photo: null },
                products: [],
                favorites: JSON.parse(localStorage.getItem('auna_favs') || '[]'),
                cart: JSON.parse(localStorage.getItem('auna_cart') || '[]'),
                uploading: false,
                currentInfo: null,
                infoData: {
                    about: { title: "–û –±—Ä–µ–Ω–¥–µ AUNA", text: "–£–∫—Ä–∞—à–µ–Ω–∏—è AUNA ‚Äî —ç—Ç–æ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö —Ñ–æ—Ä–º –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞. –ö–∞–∂–¥–æ–µ –∏–∑–¥–µ–ª–∏–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã—Ö –∫–∞–º–Ω–µ–π –∏ –∂–µ–º—á—É–≥–∞." },
                    delivery: { title: "–î–æ—Å—Ç–∞–≤–∫–∞", text: "–ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑—ã –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ –°–î–≠–ö, –ü–æ—á—Ç—É –†–æ—Å—Å–∏–∏ –∏ 5Post (–≤—ã–¥–∞—á–∞ –≤ –ü—è—Ç–µ—Ä–æ—á–∫–∞—Ö). –°—Ä–æ–∫ —Å–±–æ—Ä–∫–∏: 1-2 –¥–Ω—è." },
                    return: { title: "–í–æ–∑–≤—Ä–∞—Ç", text: "–í—ã –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å –∏–∑–¥–µ–ª–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π, –µ—Å–ª–∏ –æ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ —Ç–æ–≤–∞—Ä–Ω—ã–π –≤–∏–¥ –∏ –±–∏—Ä–∫—É." }
                },
                newP: { name: '', desc: '', price: '', cat: '–°–µ—Ä—å–≥–∏', images: [] },
                orderForm: { name: '', phone: '', address: '' },
                map: null,
                marker: null
            }
        },
        computed: {
            filteredProducts() {
                let res = this.products;
                if (!this.isAdmin) res = res.filter(p => !p.hidden);
                if (this.currentCategory !== '–í—Å–µ') res = res.filter(p => p.category === this.currentCategory);
                return res;
            },
            cartTotal() { return this.cart.reduce((s, i) => s + Number(i.price), 0); }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            openInfo(page) { this.currentInfo = page; this.burgerOpen = false; this.vibrate(); },
            openProduct(p) { this.selP = p; this.activeSize = p.sizes ? p.sizes[0] : 'Uni'; },
            toggleFavorite(p) {
                const idx = this.favorites.findIndex(f => f.id === p.id);
                if (idx > -1) this.favorites.splice(idx, 1);
                else this.favorites.push(p);
                localStorage.setItem('auna_favs', JSON.stringify(this.favorites));
            },
            isFavorite(p) { return this.favorites.some(f => f.id === p.id); },
            addToCart(p) {
                this.cart.push({...p, selectedSize: this.activeSize});
                localStorage.setItem('auna_cart', JSON.stringify(this.cart));
                tg.showAlert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!");
                this.selP = null;
            },
            removeFromCart(i) { this.cart.splice(i, 1); localStorage.setItem('auna_cart', JSON.stringify(this.cart)); },
            async uploadToImgBB(e) {
                const files = e.target.files; this.uploading = true;
                for (let file of files) {
                    const fd = new FormData(); fd.append("image", file);
                    const r = await fetch("https://api.imgbb.com/1/upload?key=839e62907e9a52f0159461b7771bcb2f", {method:"POST", body:fd});
                    const d = await r.json(); this.newP.images.push(d.data.url);
                }
                this.uploading = false;
            },
            async saveToFirebase() {
                await addDoc(collection(db, "products"), {...this.newP, createdAt: Date.now(), hidden: false, sizes: ['Uni']});
                this.newP = { name: '', desc: '', price: '', cat: '–°–µ—Ä—å–≥–∏', images: [] };
                tg.showAlert("–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
            },
            async toggleHide(p) { await updateDoc(doc(db, "products", p.id), { hidden: !p.hidden }); },
            contactSupport() { tg.openTelegramLink('https://t.me/opttania'); },
            initMap() {
                setTimeout(() => {
                    if (this.map) return;
                    this.map = new mapgl.Map('map', { center: [37.61, 55.75], zoom: 12, key: 'cab82c94-e619-42eb-9814-3361712feaf0' });
                    
                    // –ö–õ–ò–ö –ü–û –ö–ê–†–¢–ï ‚Äî –†–ê–ë–û–¢–ê–ï–¢ –¢–ï–ü–ï–†–¨ –í–°–ï–ì–î–ê
                    this.map.on('click', (e) => {
                        const lonlat = e.lngLat;
                        if (this.marker) this.marker.destroy();
                        this.marker = new mapgl.Marker(this.map, { coordinates: lonlat });
                        
                        // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å —á–µ—Ä–µ–∑ API 2GIS
                        fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lon=${lonlat[0]}&lat=${lonlat[1]}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                        .then(res => res.json())
                        .then(data => {
                            if (data.result && data.result.items.length > 0) {
                                this.orderForm.address = data.result.items[0].full_name || data.result.items[0].name;
                                this.vibrate();
                            }
                        });
                    });
                }, 500);
            },
            sendOrder() {
                if (!this.orderForm.address) return tg.showAlert("–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –Ω–∞ –∫–∞—Ä—Ç–µ!");
                const itemsText = this.cart.map(i => `‚Ä¢ ${i.name} [${i.selectedSize}]`).join('\n');
                const orderText = `üíé –ù–û–í–´–ô –ó–ê–ö–ê–ó AUNA\n\nüë§ –ò–º—è: ${this.orderForm.name}\nüìû –¢–µ–ª: ${this.orderForm.phone}\nüìç –ê–¥—Ä–µ—Å: ${this.orderForm.address}\n\nüì¶ –¢–æ–≤–∞—Ä—ã:\n${itemsText}\n\nüí∞ –ò—Ç–æ–≥–æ: ${this.cartTotal}‚ÇΩ`;
                tg.sendData(orderText);
                this.cart = []; localStorage.removeItem('auna_cart');
            }
        },
        watch: {
            activeTab(v) { if (v === 'cart') this.initMap(); }
        },
        mounted() {
            tg.ready(); tg.expand();
            if (tg.initDataUnsafe?.user) {
                const u = tg.initDataUnsafe.user;
                this.user = { first_name: u.first_name, photo: u.photo_url };
                this.orderForm.name = u.first_name;
                if (Number(u.id) === Number(this.adminId)) this.isAdmin = true;
            }
            onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), (s) => {
                this.products = s.docs.map(d => ({ id: d.id, ...d.data(), images: d.data().images || [d.data().img] }));
            });
        }
    }).mount('#app');
</script>
</body>
</html>
