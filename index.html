<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUNA jewel</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #ffffff; --text: #000000; --muted: #8e8e93; --border: #f2f2f2; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }
        [v-cloak] { display: none; }

        /* HEADER */
        header { position: sticky; top: 0; background: #fff; z-index: 100; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .logo { font-weight: 800; font-size: 16px; letter-spacing: 4px; text-transform: uppercase; }

        /* BURGER PANEL */
        .burger-panel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 2000; transform: translateX(-100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 40px 25px; }
        .burger-panel.active { transform: translateX(0); }
        .nav-link { font-size: 24px; font-weight: 800; margin-bottom: 25px; text-transform: uppercase; border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        /* GRID & CARDS */
        .catalog-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; }
        .card { background: #fff; border-radius: 12px; overflow: hidden; position: relative; border: 1px solid var(--border); }
        .img-wrap { width: 100%; aspect-ratio: 1/1.2; background: #f9f9f9; position: relative; overflow: hidden; }
        .img-wrap img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.5s; }
        .img-wrap img.loaded { opacity: 1; }
        
        .fav-btn { position: absolute; top: 8px; right: 8px; z-index: 10; }

        /* PRODUCT PAGE OVERLAY */
        .page-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 500; overflow-y: auto; }
        .slider { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; height: 60vh; background: #eee; }
        .slider img { min-width: 100%; object-fit: cover; scroll-snap-align: start; }
        
        .size-btn { border: 1px solid #000; padding: 10px 15px; border-radius: 8px; font-weight: 700; font-size: 13px; min-width: 45px; text-align: center; }
        .size-btn.active { background: #000; color: #fff; }

        /* MAP & FORM */
        #map-box { width: 100%; height: 250px; border-radius: 15px; margin: 15px 0; border: 1px solid var(--border); overflow: hidden; }
        .input-ui { width: 100%; padding: 15px; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 10px; font-family: inherit; font-size: 14px; }
        .delivery-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }
        .del-item { padding: 12px; border: 1px solid #ddd; border-radius: 10px; text-align: center; font-size: 12px; font-weight: 700; }
        .del-item.active { border-color: #000; background: #f9f9f9; }

        /* TABS */
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: #fff; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 10px 0 25px; z-index: 1000; }
        .tab-item { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; font-weight: 600; color: var(--muted); }
        .tab-item.active { color: #000; }

        .btn-black { background: #000; color: #fff; width: 100%; padding: 20px; border: none; border-radius: 15px; font-weight: 800; font-size: 14px; margin-top: 10px; }
        .badge { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 10px; padding: 2px 6px; font-size: 9px; }
    </style>
</head>
<body>

<div id="app" v-cloak>
    <header>
        <div @click="menuOpen = true; haptic('light')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </div>
        <div class="logo">AUNA jewel</div>
        <div style="width:24px"></div>
    </header>

    <div class="burger-panel" :class="{active: menuOpen}">
        <div style="text-align: right; font-weight: 800" @click="menuOpen = false; burgerSub = null">‚úï –ó–ê–ö–†–´–¢–¨</div>
        <div v-if="!burgerSub" style="margin-top:40px">
            <div class="nav-link" @click="burgerSub = 'about'; haptic('medium')">–û –Ω–∞—Å</div>
            <div class="nav-link" @click="burgerSub = 'delivery'; haptic('medium')">–î–æ—Å—Ç–∞–≤–∫–∞</div>
            <div class="nav-link" @click="burgerSub = 'return'; haptic('medium')">–í–æ–∑–≤—Ä–∞—Ç</div>
        </div>
        <div v-else style="margin-top:40px">
            <div @click="burgerSub = null; haptic('light')" style="font-weight: 800; margin-bottom: 20px">‚Üê –ù–ê–ó–ê–î</div>
            <h2 style="font-weight: 800">{{ info[burgerSub].title }}</h2>
            <p style="line-height: 1.7; color: #444">{{ info[burgerSub].text }}</p>
        </div>
    </div>

    <main>
        <div v-if="activeTab === 'catalog'">
            <div style="display:flex; gap:10px; padding:10px 15px; overflow-x:auto; scrollbar-width:none">
                <div v-for="c in ['–í—Å–µ', '–°–µ—Ä—å–≥–∏', '–¶–µ–ø–æ—á–∫–∏', '–ö–æ–ª—å—Ü–∞']" :key="c" 
                     @click="curCat = c; haptic('light')"
                     :style="{background: curCat === c ? '#000' : '#f2f2f2', color: curCat === c ? '#fff' : '#000'}"
                     style="padding:8px 16px; border-radius:20px; font-size:12px; font-weight:700; white-space:nowrap">{{c}}</div>
            </div>
            <div class="catalog-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card" @click="openProduct(p); haptic('medium')">
                    <div class="fav-btn" @click.stop="toggleFav(p); haptic('medium')">
                        <svg width="22" height="22" viewBox="0 0 24 24" :fill="isFav(p) ? 'red' : 'none'" :stroke="isFav(p) ? 'red' : 'black'" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l8.84-8.84 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                    </div>
                    <div class="img-wrap">
                        <img :src="p.safeImg" @load="p.loaded = true" :class="{loaded: p.loaded}">
                    </div>
                    <div style="padding:10px">
                        <div style="font-size:11px; font-weight:600; height:32px; overflow:hidden">{{p.name}}</div>
                        <div style="font-weight:800; font-size:14px; margin-top:5px">{{p.price}} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'fav'" style="padding:20px">
            <h2 style="font-weight: 800">–ò–ó–ë–†–ê–ù–ù–û–ï</h2>
            <div v-if="favs.length === 0" style="text-align:center; margin-top:50px; color:#aaa">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</div>
            <div class="catalog-grid" v-else>
                <div v-for="p in favs" :key="p.id" class="card" @click="openProduct(p)">
                    <div class="img-wrap"><img :src="p.safeImg" class="loaded"></div>
                    <div style="padding:10px"><div style="font-weight:700; font-size:12px">{{p.name}}</div></div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'" style="padding:20px">
            <h2 style="font-weight: 800">–û–§–û–†–ú–õ–ï–ù–ò–ï</h2>
            <div v-if="cart.length === 0" style="text-align:center; margin-top:50px">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div v-else>
                <div v-for="(item, idx) in cart" :key="idx" style="display:flex; gap:12px; margin-bottom:15px; align-items:center">
                    <img :src="item.safeImg" style="width:60px; height:60px; border-radius:10px; object-fit:cover" @click="openProduct(item)">
                    <div style="flex:1">
                        <div style="font-weight:700; font-size:13px">{{item.name}}</div>
                        <div style="font-size:11px; color:#777">–†–∞–∑–º–µ—Ä: {{item.selSize}}</div>
                    </div>
                    <div @click="removeFromCart(idx); haptic('light')">‚úï</div>
                </div>
                <div style="margin-top:30px">
                    <input class="input-ui" v-model="form.name" placeholder="–í–∞—à–µ –∏–º—è">
                    <input class="input-ui" v-model="form.phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, 9001234567)" type="tel">
                    <div class="delivery-grid">
                        <div v-for="d in ['–°–¥—ç–∫', '–ü–æ—á—Ç–∞', '5post']" :key="d" @click="form.del = d; haptic('light')" class="del-item" :class="{active: form.del === d}">{{d}}</div>
                    </div>
                    <div id="map-box"><div id="map" style="width:100%; height:100%"></div></div>
                    <div style="font-size:12px; font-weight:800; margin-bottom:20px">–ê–î–†–ï–°: {{ form.addr || '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ' }}</div>
                    <button class="btn-black" @click="sendOrder">–ó–ê–ö–ê–ó–ê–¢–¨ ‚Äî {{ cartTotal }} ‚ÇΩ</button>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'profile'" style="padding:20px">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px">
                <img :src="user.photo" style="width:70px; height:70px; border-radius:50%; background:#eee">
                <div>
                    <div style="font-weight:800; font-size:18px">{{ user.first_name }}</div>
                    <div style="font-size:12px; color:blue; font-weight:700" @click="openSupport">–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</div>
                </div>
            </div>

            <div v-if="isAdmin" style="border:2px solid #000; padding:15px; border-radius:15px">
                <h3 style="margin-top:0">–ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</h3>
                <input class="input-ui" v-model="newP.name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <textarea class="input-ui" v-model="newP.desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" style="height:80px"></textarea>
                <input class="input-ui" v-model="newP.sizes" placeholder="–†–∞–∑–º–µ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: 16,17,18)">
                <input class="input-ui" v-model="newP.price" type="number" placeholder="–¶–µ–Ω–∞">
                <select class="input-ui" v-model="newP.cat">
                    <option v-for="c in ['–°–µ—Ä—å–≥–∏', '–¶–µ–ø–æ—á–∫–∏', '–ö–æ–ª—å—Ü–∞']" :value="c">{{c}}</option>
                </select>
                <input type="file" @change="uploadToImgBB" multiple style="margin-bottom:10px">
                <div style="display:flex; gap:5px; overflow-x:auto; margin-bottom:15px">
                    <img v-for="img in newP.imgs" :src="img" style="width:50px; height:50px; object-fit:cover; border-radius:5px">
                </div>
                <button class="btn-black" @click="saveProduct" :disabled="loading">{{ loading ? '–°–û–•–†–ê–ù–ï–ù–ò–ï...' : '–î–û–ë–ê–í–ò–¢–¨ –¢–û–í–ê–†' }}</button>

                <div style="margin-top:30px">
                    <h4 style="border-bottom:1px solid #000; padding-bottom:5px">–í–∞—à–∏ —Ç–æ–≤–∞—Ä—ã</h4>
                    <div v-for="p in products" :key="p.id" style="display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid #eee; align-items:center">
                        <span style="font-size:12px; font-weight:600">{{p.name}}</span>
                        <div @click="toggleVis(p); haptic('light')" :style="{color: p.hidden ? 'red' : 'green'}" style="font-weight:800; font-size:10px">
                            {{ p.hidden ? '–°–ö–†–´–¢' : '–ü–û–ö–ê–ó–ê–ù' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="page-overlay" v-if="selP">
        <div style="position:fixed; top:20px; right:20px; z-index:1000; background:#fff; width:35px; height:35px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:900; box-shadow:0 2px 10px rgba(0,0,0,0.1)" @click="selP = null">‚úï</div>
        <div class="slider">
            <img v-for="img in selP.images" :key="img" :src="img">
        </div>
        <div style="padding:25px">
            <h1 style="font-weight:800; margin:0">{{selP.name}}</h1>
            <div style="font-size:24px; font-weight:800; margin:10px 0">{{selP.price}} ‚ÇΩ</div>
            <div style="font-weight:700; font-size:12px; margin:20px 0 10px">–†–ê–ó–ú–ï–†:</div>
            <div style="display:flex; gap:10px; margin-bottom:30px">
                <div v-for="sz in selP.sizeList" :key="sz" @click="curSz = sz; haptic('light')" class="size-btn" :class="{active: curSz === sz}">{{sz}}</div>
            </div>
            <div style="font-weight:700; font-size:12px; margin-bottom:10px">–û–ü–ò–°–ê–ù–ò–ï:</div>
            <p style="font-size:14px; color:#555; line-height:1.7; white-space:pre-line">{{selP.desc}}</p>
            <button class="btn-black" @click="addToCart(selP); haptic('medium')" style="margin-top:30px">–í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="tab-bar">
        <div class="tab-item" :class="{active: activeTab === 'catalog'}" @click="activeTab = 'catalog'; haptic('light')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
            –ö–∞—Ç–∞–ª–æ–≥
        </div>
        <div class="tab-item" :class="{active: activeTab === 'fav'}" @click="activeTab = 'fav'; haptic('light')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l8.84-8.84 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        </div>
        <div class="tab-item" :class="{active: activeTab === 'cart'}" @click="activeTab = 'cart'; haptic('light')" style="position:relative">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
            –ö–æ—Ä–∑–∏–Ω–∞ <span v-if="cart.length" class="badge">{{ cart.length }}</span>
        </div>
        <div class="tab-item" :class="{active: activeTab === 'profile'}" @click="activeTab = 'profile'; haptic('light')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            –ü—Ä–æ—Ñ–∏–ª—å
        </div>
    </nav>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const fbCfg = {
        apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw",
        authDomain: "auna-jewel.firebaseapp.com",
        projectId: "auna-jewel",
        storageBucket: "auna-jewel.appspot.com"
    };

    const app = initializeApp(fbCfg);
    const db = getFirestore(app);
    const tg = window.Telegram.WebApp;

    Vue.createApp({
        data() {
            return {
                activeTab: 'catalog', menuOpen: false, burgerSub: null,
                curCat: '–í—Å–µ', products: [
                    { id: 1, category: '–∫–æ–º–ª–µ–∫—Ç—ã', name: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º —á–µ—Ä–Ω—ã–π', price: 2900, images: ['1.jpg'], sizes: ['42','44'], selS: '42', aIdx: 0, desc: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º.' },
                    { id: 2, category: '—Å–µ—Ä—å–≥–∏', name: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º –±–æ—Ä–¥–æ–≤—ã–π', price: 2900, images: ['2.jpg'], sizes: ['42','44'], selS: '42', aIdx: 0, desc: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º.' }
                ], selP: null, curSz: null, loading: false,
                favs: JSON.parse(localStorage.getItem('auna_fav') || '[]'),
                cart: JSON.parse(localStorage.getItem('auna_cart') || '[]'),
                user: { first_name: '–ì–æ—Å—Ç—å', photo: '', id: 0 },
                isAdmin: false, adminId: 387881523,
                form: { name: '', phone: '', del: '–°–¥—ç–∫', addr: '' },
                newP: { name: '', desc: '', price: '', cat: '–°–µ—Ä—å–≥–∏', sizes: '', imgs: [] },
                info: {
                    about: { title: '–û –ë–†–ï–ù–î–ï', text: 'AUNA jewel ‚Äî —ç—Ç–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –º–∏–Ω–∏–º–∞–ª–∏–∑–º–∞ –∏ –ø—Ä–∏—Ä–æ–¥–Ω–æ–π –∫—Ä–∞—Å–æ—Ç—ã. –ú—ã —Å–æ–∑–¥–∞–µ–º —É–∫—Ä–∞—à–µ–Ω–∏—è –∏–∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã—Ö –∫–∞–º–Ω–µ–π –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ü–µ–Ω–∏—Ç —ç—Å—Ç–µ—Ç–∏–∫—É.' },
                    delivery: { title: '–î–û–°–¢–ê–í–ö–ê', text: '–ú—ã –¥–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ –°–î–≠–ö, –ü–æ—á—Ç—É –∏ 5post. –°–±–æ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 1-2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è.' },
                    return: { title: '–í–û–ó–í–†–ê–¢', text: '–í–µ—Ä–Ω—É—Ç—å —É–∫—Ä–∞—à–µ–Ω–∏–µ –º–æ–∂–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π, –µ—Å–ª–∏ –æ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ —Ç–æ–≤–∞—Ä–Ω—ã–π –≤–∏–¥ –∏ –≤—Å–µ –±–∏—Ä–∫–∏.' }
                },
                map: null
            }
        },
        computed: {
            filteredProducts() {
                let p = this.products;
                if (!this.isAdmin) p = p.filter(x => !x.hidden);
                return this.curCat === '–í—Å–µ' ? p : p.filter(x => x.cat === this.curCat);
            },
            cartTotal() { return this.cart.reduce((a, b) => a + Number(b.price), 0); }
        },
        methods: {
            haptic(s) { if(s==='light') tg.HapticFeedback.impactOccurred('light'); else tg.HapticFeedback.impactOccurred('medium'); },
            isFav(p) { return this.favs.some(x => x.id === p.id); },
            toggleFav(p) {
                if(this.isFav(p)) this.favs = this.favs.filter(x => x.id !== p.id);
                else this.favs.push({...p});
                localStorage.setItem('auna_fav', JSON.stringify(this.favs));
            },
            openProduct(p) { this.selP = p; this.curSz = p.sizeList[0]; },
            addToCart(p) {
                this.cart.push({...p, selSize: this.curSz});
                localStorage.setItem('auna_cart', JSON.stringify(this.cart));
                tg.showAlert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!");
                this.selP = null;
            },
            removeFromCart(idx) {
                this.cart.splice(idx, 1);
                localStorage.setItem('auna_cart', JSON.stringify(this.cart));
            },
            openSupport() { tg.openTelegramLink('https://t.me/opttania'); },
            async uploadToImgBB(e) {
                this.loading = true;
                for(let f of e.target.files) {
                    let fd = new FormData(); fd.append("image", f);
                    let r = await fetch("https://api.imgbb.com/1/upload?key=839e62907e9a52f0159461b7771bcb2f", {method:"POST", body:fd});
                    let d = await r.json(); this.newP.imgs.push(d.data.url);
                }
                this.loading = false;
            },
            async saveProduct() {
                await addDoc(collection(db, "products"), {...this.newP, createdAt: Date.now(), hidden: false, images: this.newP.imgs});
                tg.showAlert("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!");
                this.newP = { name: '', desc: '', price: '', cat: '–°–µ—Ä—å–≥–∏', sizes: '', imgs: [] };
            },
            async toggleVis(p) { await updateDoc(doc(db, "products", p.id), { hidden: !p.hidden }); },
            initMap() {
                if(this.map) return;
                setTimeout(() => {
                    this.map = new mapgl.Map('map', { center: [37.61, 55.75], zoom: 12, key: 'cab82c94-e619-42eb-9814-3361712feaf0' });
                    this.map.on('click', e => {
                        fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lon=${e.lngLat[0]}&lat=${e.lngLat[1]}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                        .then(r => r.json()).then(res => {
                            if(res.result?.items[0]) this.form.addr = res.result.items[0].full_name;
                        });
                    });
                }, 500);
            },
            sendOrder() {
                const phone = this.form.phone.replace(/\D/g, '');
                if(phone.length < 10 || phone.length > 11) return tg.showAlert("–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 10-11 —Ü–∏—Ñ—Ä!");
                const items = this.cart.map(i => `${i.name} (${i.selSize})`).join(', ');
                const txt = `üíé –ù–û–í–´–ô –ó–ê–ö–ê–ó AUNA\n\nüë§ –ò–º—è: ${this.form.name}\nüìû –¢–µ–ª: ${this.form.phone}\nüöö –î–æ—Å—Ç–∞–≤–∫–∞: ${this.form.del}\nüìç –ê–¥—Ä–µ—Å: ${this.form.addr}\nüì¶ –¢–æ–≤–∞—Ä—ã: ${items}\nüí∞ –°—É–º–º–∞: ${this.cartTotal}‚ÇΩ`;
                tg.sendData(txt);
                this.cart = [];
                localStorage.removeItem('auna_cart');
                tg.showAlert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
            }
        },
        watch: {
            activeTab(v) { if(v === 'cart') this.initMap(); }
        },
        mounted() {
            tg.ready(); tg.expand();
            if(tg.initDataUnsafe?.user) {
                const u = tg.initDataUnsafe.user;
                this.user = { first_name: u.first_name, photo: u.photo_url, id: u.id };
                this.form.name = u.first_name;
                if(u.id == this.adminId) this.isAdmin = true;
            }
            onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), snap => {
                this.products = snap.docs.map(d => {
                    const data = d.data();
                    return { id: d.id, ...data, 
                        safeImg: data.images?.[0] || '', 
                        sizeList: data.sizes ? data.sizes.split(',').map(s => s.trim()) : [],
                        loaded: false 
                    }
                });
            });
        }
    }).mount('#app');
</script>
</body>
</html>
